### Characters Scripted Effects

# Used on new generated characters
TOW_initialize_character = {
	TOW_initialize_character_race_from_culture = yes
	TOW_update_character_race_from_liege = yes
	TOW_initialize_character_religious_features = yes
	TOW_initialize_character_portraits_features = yes
}

### New character assignement based on Culture

TOW_initialize_character_race_from_culture = {
	if = {
		limit = {
			has_character_flag = race_assigned
		}
		log = " -- TOW -- Warning: Trying to assign a race on a character ([This.GetTitledName]) who already has the race_assigned flag !"
	}

	trigger_switch = {
		on_trigger = culture_group
		
		human = { add_trait = race_human }
		orcish = {
			if = {
				limit = {
					OR = {
						NOT = { culture = twilights_hammer }
						has_global_flag = thirdwar_bookmark
						has_global_flag = wow_bookmark
						#Twilight's hammer was destroyed during second war, or at any point before
					}
				}
				add_trait = race_orc
				if = {
					limit = {
						culture = twilights_hammer
					}
					set_graphical_culture = bleeding_hollow # doesn't matter
					add_trait = race_gorc
				}
				if = {
					limit = { graphical_culture = rorcgfx }
					add_trait = race_rorc
				}
				if = {
					limit = { graphical_culture = borcgfx }
					add_trait = race_borc
				}
				if = {
					limit = { graphical_culture = morcgfx }
					add_trait = race_morc
				}
				if = {
					limit = { graphical_culture = dorcgfx }
					add_trait = race_dorc
				}
				if = {
					limit = { graphical_culture = worcgfx }
					add_trait = race_worc
				}
				if = {
					limit = { graphical_culture = gorcgfx }
					add_trait = race_gorc
				}
			}
			else = {
				add_trait = race_pale_orc
			}
		}
		dwarf = {
			add_trait = race_dwarf
			if = {
				limit = { graphical_culture = blackdwarfgfx }
				add_trait = race_blackdwarf
			}
		}
		gnome = { add_trait = race_gnome }
		goblin = { add_trait = race_goblin }
		ogre = { add_trait = race_ogre }
		murloc = { add_trait = race_murloc }
		gnoll = { add_trait = race_gnoll }
		kobold = { add_trait = race_kobold }
		trogg = { add_trait = race_trogg }
		vrykul = { add_trait = race_vrykul }
	}
	trigger_switch = {
		on_trigger = culture
		
		high_elven = { add_trait = race_high_elf }
		blood_elven = { add_trait = race_blood_elf }
		night_elven = { add_trait = race_night_elf }
		naga = { add_trait = race_naga }
		felblood = {
			add_trait = race_blood_elf
			set_graphical_culture = felblood
			culture = blood_elven
			add_trait = fel_corrupted
		}
		wretched = {
			add_trait = race_wretched
			set_graphical_culture = race_wretched
			culture = blood_elven
		}
		red_dragonflight = { add_trait = race_dragon add_trait = race_reddragon }
		blue_dragonflight = { add_trait = race_dragon add_trait = race_bluedragon }
		bronze_dragonflight = { add_trait = race_dragon add_trait = race_bronzedragon }
		green_dragonflight = { add_trait = race_dragon add_trait = race_greendragon }
		black_dragonflight = { add_trait = race_dragon add_trait = race_blackdragon }
		chromatic_dragonflight = { add_trait = race_dragon }
		twilight_dragonflight = { add_trait = race_dragon }
		infinite_dragonflight = { add_trait = race_dragon add_trait = race_infinitedragon }
		nightmare_dragonflight = { add_trait = race_dragon add_trait = race_nightdragon }
		scourge = {
			add_trait = race_human
			add_trait = race_undead_scourge
		}
		forsaken = {
			add_trait = race_human
			add_trait = race_undead_forsaken
		}
		amani = { add_trait = race_troll_forest }
		atalai = { add_trait = race_troll_jungle }
		razorbranch = { add_trait = race_troll_jungle }
		firetree = { add_trait = race_troll_forest }
		mossflayer = { add_trait = race_troll_forest }
		revantusk = { add_trait = race_troll_forest }
		vilebranch = { add_trait = race_troll_forest }
		shadowpine = { add_trait = race_troll_forest }
		witherbark = { add_trait = race_troll_forest }
		bloodscalp = { add_trait = race_troll_jungle }
		darkspear = { add_trait = race_troll_jungle }
		gurubashi = { add_trait = race_troll_jungle }
		shatterspear = { add_trait = race_troll_jungle }
		skullsplitter = { add_trait = race_troll_jungle }
		drakkari = { add_trait = race_troll_ice }
		frostmane = { add_trait = race_troll_ice }
		sandfury = { add_trait = race_troll_sand }
		smolderthorn = { add_trait = race_troll_forest }
		shadowglen = { add_trait = race_troll_forest }
		winterax = { add_trait = race_troll_ice }
		winterfang = { add_trait = race_troll_ice }
		shadowtooth = { add_trait = race_troll_dark }
		zandalari = { add_trait = race_troll_zandalari }
		eredar = { add_trait = race_eredar }
		nathrezim = { add_trait = race_dreadlord }
		sayaad = { add_trait = race_succubus }
		ered_ruin = { add_trait = race_doomlord }
		annihilan = { add_trait = race_pit_lord } 
		mo_arg = {
			if = {
				limit = {
					NOT = { stewardship = 9 } # Will need tweaking
				}
				add_trait = race_fel_lord
			}
			else = {
				add_trait = race_mo_arg
			}
		}
		shivarra = { add_trait = race_shivarra }
		antaen = { add_trait = race_antaen }
		aranasi = { add_trait = race_aranasi }
		inquisitor = { add_trait = race_inquisitor }
		observer = { add_trait = race_observer }
		draenei = { add_trait = race_draenei }
		#broken = { add_trait = race_broken }
		lost_one = { add_trait = race_lost_one }
		nraqi = { add_trait = race_faceless }
		voidwalker = { add_trait = race_voidwalker }
		air_elemental = { add_trait = race_air_elemental }
		earth_elemental = { add_trait = race_earth_elemental }
		fire_elemental = { add_trait = race_fire_elemental }
		water_elemental = { add_trait = race_water_elemental }
	}

	if = {
		limit = {
			TOW_has_race = no
		}
		log = " -- TOW -- : TOW_initialize_character_race_from_culture failed. Character: [This.GetID] ([This.GetBestName]). Culture: [This.Culture.GetName]."
	}
	set_character_flag = race_assigned
}

TOW_update_character_race_from_liege = {
	if = {
		limit = { trait = race_orc }
	
		if = {
			limit = {
				liege = {
					graphical_culture = borcgfx
				}
			}
			random_list = {
				1 = {
					set_graphical_culture = mag_har
				}
				10 = { # Set a modifier to make this 0 if in Draenor/Outland
					set_graphical_culture = bleeding_hollow # doesn't matter
				}
			}
		}
		else_if = {
			limit = {
				liege = {
					graphical_culture = rorcgfx
				}
				OR = {
					religion = burning_legion
					religion = demonology
				}
			}
			random_list = {
				1 = {
					set_graphical_culture = fel_orc
					random_list = {
						1 = {
							add_trait = fel_corrupted
						}
						4 = {
							add_trait = fel_tainted
						}
					}
				}
				1 = { # Set a modifier to make this 0 if in Outland
					set_graphical_culture = bleeding_hollow # shouldn't matter
					random_list = {
						1 = {
							add_trait = fel_tainted
						}
						4 = {
							add_trait = fel_touched
						}
					}
				}
			}
		}
	}


	if = {
		limit = { 
			OR = {
				trait = race_high_elf
				trait = race_blood_elf
			}
			liege = {
				graphical_culture = welvengfx
				trait = race_wretched
			}
		}
		set_graphical_culture = wretched
		remove_trait = race_high_elf
		remove_trait = race_blood_elf
		add_trait = race_wretched
	}
}

# Used on new characters
TOW_initialize_character_portraits_features = {
	if = { # Night elf female tattoo
		limit = { TOW_can_have_female_night_elf_tattoo = yes }
		TOW_female_night_elf_assign_random_tattoo_depending_on_traits = yes
	}
}

TOW_initialize_character_religious_features = {
	hidden_tooltip = {
		if = {
			limit = {
				TOW_religion_practices_astrology = yes
			}
			add_western_zodiac_trait_effect = yes
		}
		if = {
			limit = {
				TOW_religion_has_pagan_branches = yes
			}
			random_list = {  
				5 = {
					add_trait = pagan_branch_1
				}
				25 = {
					add_trait = pagan_branch_2
				}
				25 = {
					add_trait = pagan_branch_3
				}
				25 = {
					add_trait = pagan_branch_4
				}
			}
		}
	}
}

TOW_remove_class_traits = {
	remove_trait = mage
	remove_trait = warlock
	remove_trait = necromancer
	remove_trait = priest
	remove_trait = shaman
	remove_trait = druid
	remove_trait = rogue
	remove_trait = ranger
	remove_trait = engineer
	remove_trait = warrior
	remove_trait = paladin
	remove_trait = monk
	remove_trait = death_knight
	remove_trait = demon_hunter
}

TOW_employed_remove_unwanted_traits_with_ET_employer = {
	if = {
		limit = { event_target:employer = { accepts_warlock = no } }
		remove_trait = warlock
	}
	if = {
		limit = { event_target:employer = { accepts_necromancer = no } }
		remove_trait = necromancer
	}
	if = {
		limit = { event_target:employer = { accepts_rogue = no } }
		remove_trait = rogue
	}
	remove_trait = demon_hunter
	remove_trait = death_knight
}

TOW_new_character_employed_effect = {
	Keitaro_remove_bad_traits = yes
	Keitaro_remove_lifestyle_traits = yes
	TOW_remove_class_traits = yes
	TOW_initialize_character = yes
	TOW_employed_remove_unwanted_traits_with_ET_employer = yes
}

TOW_set_newly_landed_character_government = {
	set_government_type = feudal_government
}

join_prev_society = {
	PREV = {
		society = {
			save_event_target_as = join_prev_society_join_prev_society
		}
	}
	join_society = event_target:join_prev_society_join_prev_society
	clear_event_target = join_prev_society_join_prev_society
}