namespace = gurubashiwar

#If the gurubashi emperor has the Hakkar heresy, set culture to Hakkari and give free CBs on neighbours.
character_event = {
	id = gurubashiwar.1
	desc = EVTDESCGURUB.1 # Your devotion to Hakkar, the Soulflayer, has been noted through the realm. Some, such as the priests of the Atal'ai, rejoice in your piety, but more traditional trolls do not. In fact, some of them have even started refusing to call you [Root.Culture.GetName], instead calling you Hakkari.
	picture = "GFX_evt_hakkar1"
	border = "GFX_event_normal_frame_religion"
	
	min_age = 16
	capable_only = yes
	prisoner = no
	
	mean_time_to_happen = {
		days = 100
	}
	
	trigger = {
		OR = {
			true_religion = hakkar
			has_character_modifier = loa_hakkar
		}
		NOR = {
			culture = atalai
			trait = race_troll_zandalari
			has_global_flag = gurubashiwar_start
		}
		OR = {
			trait = race_troll_jungle
			trait = race_troll_ice
			trait = race_troll_forest
			trait = race_troll_sand
			trait = race_troll_dark
		}
		has_landed_title = e_gurubashi
		has_global_flag = trollwars_bookmark
		NOT = {
			has_game_rule = {
				name = troll_wars_events
				value = off
			}
		}
	}
	
	option = {
		name = EVTOPTGURUB.1 # Blood for the Blood Loa!
		culture = hakkari
		religion = hakkar
		set_global_flag = gurubashiwar_start
	}
}

#The atal'ai switch to Hakkar's cult.
character_event = {
	id = gurubashiwar.2
	desc = EVTDESCGURUB.2 # It appears that the gurubashi emperor has finally seen the truth the Atal'ai have known for a long time: Hakkar is the strongest of the Loa, and any who spill blood for him can also partake in this power. For years you have sacrified to other, weaker Loa for appearances, but now you can finally show your true colours!	
	picture = "GFX_evt_shadowy_cabal"
	border = "GFX_event_normal_frame_religion"
	
	min_age = 16
	prisoner = no
	only_capable = yes
	
	mean_time_to_happen = {
		days = 10
	}
	
	trigger = {
		culture = atalai
		has_global_flag = gurubashiwar_start
		NOR = {
			trait = race_troll_zandalari
			has_global_flag = gurubashiwar_rebel_win
		}
		OR = {
			trait = race_troll_jungle
			trait = race_troll_forest
			trait = race_troll_ice
			trait = race_troll_sand
			trait = race_troll_dark
		}
	}
	
	option = {
		name = EVTOPTGURUB.1 # Blood for the Blood Loa!
		religion = hakkar
		any_playable_ruler = {
			limit = {
				has_landed_title = e_gurubashi
			}
			ROOT = {
				opinion = {
					modifier = hakkari_emperor
					who = PREV
					years = 1000
				}
			}
		}
		if = {
			limit = {
				top_liege = {
					character = ROOT
				}
				is_landed = yes
				NOR = {
					tier = EMPEROR
				}
			}
			any_playable_ruler = {
				limit = {
					has_landed_title = e_gurubashi
				}
				ROOT = {
					set_defacto_liege = PREV
				}
			}
		}
	}
}

#Switch to hakkari any gurubashi who converts to the heresy.
character_event = {
	id = gurubashiwar.3
	desc = EVTDESCGURUB.3 # Following the emperor's example, you have started calling yourself hakkari, rather than [Root.Culture.GetName], as all true followers of the Soulflayer are doing.
	picture = "GFX_evt_shadowy_cabal"
	border = "GFX_event_normal_frame_religion"
	
	mean_time_to_happen = {
		days = 30
	}
	
	trigger = {
		has_global_flag = gurubashiwar_start
		top_liege = {
			NOT = { character = ROOT }
			has_landed_title = e_gurubashi
			trait = race_troll_zandalari
		}
		OR = {
			trait = race_troll_jungle
			trait = race_troll_forest
			trait = race_troll_ice
			trait = race_troll_sand
			trait = race_troll_dark
		}
		OR = {
			true_religion = hakkar
			has_character_modifier = loa_hakkar
		}
		NOT = {
			has_global_flag = gurubashiwar_rebel_win
		}
	}
	
	option = {
		name = EVTOPTGURUB.1 # Blood for the Blood Loa!
		if = {
			limit = {
				culture = gurubashi
			}
			culture = hakkari
		}
		religion = hakkar
		any_playable_ruler = {
			limit = {
				has_landed_title = e_gurubashi
			}
			ROOT = {
				opinion = {
					modifier = hakkari_emperor
					who = PREV
					years = 1000
				}
			}
		}
	}
}

#Zandalari emissary shows up in the court of a duke (or king, if there are any) who doesn't follow Hakkar. Offers help in fighting the emperor before Hakkar can be summoned.
narrative_event = {
	id = gurubashiwar.4
	title = EVTTITLEGURUB.4 # The Gurubashi Civil War
	desc = EVTDESCGURUB.4 # An envoy from far Zandalar has arrived in your court, bringing dire news. Though the priests of the Zandalari are happy that the Gurubashi have returned to their expansionism, they are worried about the rise of Hakkar's cult. The Loa of Blood, they say, will NEVER be satisfied and demand ever more blood until all life on the world is wiped out. They urge you to pick up arms against the Hakkari emperor and his Atal'ai cohorts. They promise you aid in this conflict and guarantee that the other rulers in the empire who have stayed true to the Loa will surely support you in this most holy war.
	picture = "GFX_evt_zandalari_meeting"
	border = "GFX_event_narrative_frame_diplomacy"
	
	min_age = 16
	prisoner = no
	capable_only = yes
	
	mean_time_to_happen = {
		years = 10
		modifier = {
			factor = 0.5
			top_liege = {
				ROOT = {
					opinion = {
						who = PREV
						value = -49
					}
				}
			}
		}
	}
	
	trigger = {
		top_liege = {
			NOT = { character = ROOT }
			has_landed_title = e_gurubashi
		}
		has_global_flag = gurubashiwar_start
		NOR = {
			has_character_flag = refused_gurubashiwar_dow
			has_character_flag = gurubashiwar_rebel_leader
			has_global_flag = gurubashiwar_dow
			culture = hakkari
			culture = atalai
			true_religion = hakkar
			has_character_modifier = loa_hakkar
		}
		OR = {
			trait = race_troll_jungle
			trait = race_troll_ice
			trait = race_troll_forest
			trait = race_troll_sand
			trait = race_troll_dark
			trait = race_troll_zandalari
		}
		higher_real_tier_than = COUNT
	}
	
	option = {
		name = EVTOPTGURUB.4.a # Yes, something must be done about this.
		ai_chance = {
			factor = 100
		}
		set_global_flag = gurubashiwar_dow
		prestige = 50
		piety = 50
		wealth = 150
		create_character = {
			random_traits = yes
			culture = zandalari
			religion = loa
			age = 33
			trait = race_troll_zandalari
			trait = zealous
			trait = proud
			trait = content
			flag = race_assigned
		}
		location = {
			ROOT = {
				spawn_unit = {
					province = PREV
					owner = ROOT
					troops = {
						mages = { 300 300 }
					}
					attrition = 0
					can_toggle_looting = yes
					reinforces = no
					earmark = gurubashiwar_troops
				}
			}
		}
		set_character_flag = gurubashiwar_rebel_leader
		add_character_modifier = { 
			name = warlord
			duration = 365
		}
		create_title = {
			tier = KING
			landless = yes
			temporary = yes
			culture = ROOT
			name = GURUBASHI_WAR_REBELS
			holder = ROOT
		}
		any_playable_ruler = {
			limit = {
				has_landed_title = e_gurubashi
			}
			set_character_flag = hakkari_emperor
			narrative_event = { id = gurubashiwar.6 }
			reverse_war = {
				target = PREV
				casus_belli = overthrow_ruler
				infamy = 0
			}
			any_vassal = {
				limit = {
					NOR = {
						culture = atalai
						culture = hakkari
						true_religion = hakkar
						has_character_modifier = loa_hakkar
					}
				}
				narrative_event = { id = gurubashiwar.5 }
			}
			any_realm_character = {
				limit = {
					ai = no
					OR = {
						true_religion = hakkar
						has_character_modifier = loa_hakkar
					}
				}
				narrative_event = { id = gurubashiwar.7 }
			}
			ROOT = {
				any_realm_character = {
					limit = {
						OR = {
							culture = atalai
							culture = hakkari
						}
						OR = {
							true_religion = hakkar
							has_character_modifier = loa_hakkar
						}
					}
					set_defacto_liege = PREVPREV
				}
			}
		}
		any_playable_ruler = {
			limit = {
				ai = no
				OR = {
					trait = race_troll_jungle
					trait = race_troll_forest
					trait = race_troll_ice
					trait = race_troll_sand
					trait = race_troll_dark
					trait = race_troll_zandalari
				}
				NOR = {
					top_liege = {
						has_landed_title = e_gurubashi
					}
				}
			}
			narrative_event = { id = gurubashiwar.8 }
		}
	}
	
	option = {
		name = EVTOPTGURUB.4.b # No, I cannot.
		ai_chance = {
			factor = 1
			modifier = {
				factor = 50
				has_game_rule = {
					name = troll_wars_events
					value = alternate
				}
			}
		}
		set_character_flag = refused_gurubashiwar_dow
		prestige = -50
		piety = -50
		random = {
			chance = 30
			remove_trait = brave
			add_trait = craven
		}
		random = {
			chance = 30
			remove_trait = brave
		}
	}
}

#Other non-Hakkar in the realm are given the chance to rise up under the rebellion leader.
narrative_event = {
	id = gurubashiwar.5
	title = EVTTITLEGURUB.4 # The Gurubashi Civil War
	desc = EVTDESCGURUB.5 # Word reaches you that [From.GetBestName] has risen against the Hakkari emperor, and is backed by the Zandalari themselves! [From.GetSheHe] calls upon you to aid [From.GetHerHim] in this conflict.
	picture = "GFX_evt_zandalari_meeting"
	border = "GFX_event_narrative_frame_war"
	
	prisoner = no
	
	is_triggered_only = yes
	
	trigger = {
		NOR = {
			has_character_flag = refused_gurubashiwar_call
			has_character_flag = accepted_gurubashiwar_call
			true_religion = hakkar
			has_character_modifier = loa_hakkar
			culture = hakkari
			culture = atalai
		}
		has_global_flag = gurubashiwar_dow
	}
	
	option = {
		ai_chance = {
			factor = 100
		}
		name = EVTOPTGURUB.5.a # Death to the Hakkari!
		set_defacto_liege = FROM
		set_character_flag = accepted_gurubashiwar_call
		any_playable_ruler = {
			limit = {
				has_landed_title = e_gurubashi
			}
			PREV = {
				any_realm_character = {
					limit = {
						OR = {
							culture = atalai
							culture = hakkari
						}
						OR = {
							true_religion = hakkar
							has_character_modifier = loa_hakkar
						}
					}
					set_defacto_liege = PREVPREV
				}
			}
		}
	}
	option = {
		name = EVTOPTGURUB.4.b # No, I cannot.
		ai_chance = {
			factor = 1
			modifier = {
				factor = 50
				has_game_rule = {
					name = troll_wars_events
					value = alternate
				}
			}
		}
		set_character_flag = refused_gurubashiwar_call
		prestige = -50
		piety = -50
		random = {
			chance = 30
			remove_trait = brave
			add_trait = craven
		}
		random = {
			chance = 30
			remove_trait = brave
		}
	}
}

#Emperor is notified.
narrative_event = {
	id = gurubashiwar.6
	title = EVTTITLEGURUB.4 # The Gurubashi Civil War
	desc = EVTDESCGURUB.6 # Goaded by the weak Zandalari, [From.GetBestName] has declared open rebellion on you! They claim that you've been "corrupted" by Hakkar and must be destroyed. But you know better. Hakkar is strong, as are all who follow him. You will spill [From.GetBestName]'s blood for the Loa of Blood, and prove his power to the world!
	picture = "GFX_evt_battle_mesoamerican"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.6 # These rebels will pay!
	}
}

#A hakkari player who is not the emperor is notified.
narrative_event = {
	id = gurubashiwar.7
	title = EVTTITLEGURUB.4 # The Gurubashi Civil War
	desc = EVTDESCGURUB.7 # Goaded by the weak Zandalari, [From.GetBestName] has declared open rebellion on your liege! They claim that you've been "corrupted" by Hakkar and must be destroyed. Naturally, the emperor has responded by declaring [From.GetHerHim] a traitor and vowed that [From.GetHerHis] blood will feed the Soulflayer.
	picture = "GFX_evt_battle_mesoamerican"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.6 # These rebels will pay!
	}
}

#Troll players outside the realm notified.
narrative_event = {
	id = gurubashiwar.8
	title = EVTTITLEGURUB.4 # The Gurubashi Civil War
	desc = EVTDESCGURUB.8 # Deep in the jungles of Stranglethorn, civil war has broken out. [From.GetBestName] has, backed by the Zandalari, risen up and declared war against the emperor of Zul'Gurub, who has recently turned to the worship of Hakkar. Regardless of the outcome, this conflict may change the jungle trolls forever.
	picture = "GFX_evt_battle_mesoamerican"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.8 # Troubling.
	}
}

#Rebels win, Gurubashi empire destroyed.
narrative_event = {
	id = gurubashiwar.9
	title = EVTTITLEGURUB.9 # Fall of the Hakkari
	desc = EVTDESCGURUB.9 # The foul Hakkari emperor has been cast down, and the threat of Hakkar being unleashed on the world appears to be no more. Though this victory also means the end of the Gurubashi empire, it was for the greater good of the world.
	picture = GFX_evt_throne_room_mesoamerican
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = gurubashiwar_dow
		NOR = {
			has_global_flag = gurubashiwar_rebel_win
			has_global_flag = gurubashiwar_emp_win
		}
		ROOT = {
			has_character_flag = gurubashiwar_rebel_leader
		}
		FROM = {
			has_character_flag = hakkari_emperor
		}
	}
	
	option = {
		name = EVTOPTGURUB.9 # It had to be done.
		hidden_tooltip = { character_event = { id = gurubashiwar.32 } }
		prestige = 300
		piety = 300
		disband_event_forces = gurubashiwar_troops
		remove_character_modifier = warlord
		FROM = {
			death = {
				death_reason = death_execution
				killer = ROOT
			}
		}
		any_playable_ruler = {
			limit = {
				ai = no
				NOR = {
					top_liege = {
						has_landed_title = e_gurubashi
					}
				}
			}
			narrative_event = { id = gurubashiwar.10 }
		}
		e_gurubashi = {
			holder_scope = {
				any_realm_character = {
					limit = {
						OR = {
							culture = hakkari
							true_religion = hakkar
							has_character_modifier = loa_hakkar
						}
						NOT = { culture = atalai }
					}
					imprison = ROOT
				}
			}
			destroy_landed_title = THIS
		}
	}
}

#Troll players outside the realm notified.
narrative_event = {
	id = gurubashiwar.10
	title = EVTTITLEGURUB.9 # Fall of the Hakkari
	desc = EVTDESCGURUB.10 # The gurubashi empire has fallen to rebellion, and the Hakkari have been cast down. The threat from the Soulflayer is over, at least for now.
	picture = "GFX_evt_throne_room_mesoamerican"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.10 # Interesting.
	}
}

#Emperor wins.
character_event = {
	id = gurubashiwar.11
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = gurubashiwar_dow
		NOR = {
			has_global_flag = gurubashiwar_rebel_win
			has_global_flag = gurubashiwar_emp_win
		}
		ROOT = {
			has_character_flag = gurubashiwar_rebel_leader
		}
		FROM = {
			has_character_flag = hakkari_emperor
		}
	}
	
	immediate = {
		FROM = {
			narrative_event = { id = gurubashiwar.12 }
			any_realm_character = {
				limit = {
					NOR = {
						culture = atalai
						culture = hakkari
						true_religion = hakkar
						has_character_modifier = loa_hakkar
					}
				}
				ROOT = {
					imprison = FROM
					}
				}
			}
		set_global_flag = gurubashiwar_emp_win
		death = {
			death_reason = death_execution
			killer = FROM
		}
	}
}

#Emperor is notified.
narrative_event = {
	id = gurubashiwar.12
	title = EVTTITLEGURUB.12 # Hakkari Triumphant
	desc = EVTDESCGURUB.12 # The traitors that sought to destroy you are now sacrifices to the great Soulflayer. Today marks the start of a new era, one where the Hakkari will show the world the power of Hakkar.
	picture = GFX_evt_throne_room_mesoamerican
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.12 # The Zandalari should learn not to meddle.
		hidden_tooltip = { character_event = { id = gurubashiwar.32 } }
		prestige = 300
		piety = 300
		any_playable_ruler = {
			limit = {
				ai = no
				OR = {
					trait = race_troll_jungle
					trait = race_troll_forest
					trait = race_troll_ice
					trait = race_troll_sand
					trait = race_troll_dark
					trait = race_troll_zandalari
				}
				NOR = {
					top_liege = {
						has_landed_title = e_gurubashi
					}
				}
			}
			narrative_event = { id = gurubashiwar.13 }
		}
	}
}

#Troll players outside the realm notified.
narrative_event = {
	id = gurubashiwar.13
	title = EVTTITLEGURUB.12 # Hakkari Triumphant
	desc = EVTDESCGURUB.13 # The gurubashi empire has triumphed over the rebels and the Hakkari continue in charge.
	picture = GFX_evt_throne_room_mesoamerican
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.10 # Interesting.
	}
}

#Atal'ai keep trying to summon Hakkar in the temple of Atal'Hakkar.
narrative_event = {
	id = gurubashiwar.14
	title = EVTTITLEGURUB.14 # The Temple of Atal'Hakkar
	desc = EVTDESCGURUB.14 # Those damnable Zandalari ruined it all when they led a rebellion and deposed the glorious hakkari emperor. Yet, hope remains. The temple of Atal'Hakkar is still within your control, and from there the Soulflayer can be brought forth!
	picture = "GFX_evt_troll_temple"
	border = "GFX_event_narrative_frame_religion"
	
	mean_time_to_happen = {
		years = 5
	}
	
	trigger = {
		culture = atalai
		OR = {
			trait = race_troll_jungle
			trait = race_troll_forest
			trait = race_troll_ice
			trait = race_troll_sand
			trait = race_troll_dark
		}
		OR = {
			has_landed_title = c_atal_hakkar
			any_realm_character = { has_landed_title = c_atal_hakkar }
		}
		has_global_flag = gurubashiwar_rebel_win
		NOR = {
			has_global_flag = gurubashiwar_atalai_persist
			has_global_flag = gurubashiwar_atalai_desist
		}
	}
	
	option = {
		ai_chance = {
			factor = 100
		}
		name = EVTOPTGURUB.14.a # Yes, Hakkar will rise still!
		set_global_flag = gurubashiwar_atalai_persist
		narrative_event = {
			id = gurubashiwar.15
			days = 20
			random = 30
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 50
				has_game_rule = {
					name = troll_wars_events
					value = off
				}
			}
		}
		name = EVTOPTGURUB.14.b # No, we should just give up.
		religion = loa
		prestige = -50
		piety = -50
		set_global_flag = gurubashiwar_atalai_desist
	}
}

#Green dragons show up to stop them.
narrative_event = {
	id = gurubashiwar.15
	title = EVTTITLEGURUB.15 # Green Interlopers
	desc = EVTDESCGURUB.15 # As if the rebels hadn't been enough, now green dragons have come to try and stop your holy work! This cannot be allowed! Defend the Temple and defeat these dragons!
	picture = "GFX_evt_green_dragonflight"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.15 # Damn them!
		set_global_flag = gurubashiwar_atalai_war
		create_character = {
			random_traits = no
			name = "Eranikus"
			culture = green_dragonflight
			religion = cult_of_the_dreamer
			dynasty = 101005
			employer = THIS
			age = 7200 # Avoiding setting it so they're older than year 1
			attributes = {
				diplomacy = 13
				martial = 18
				stewardship = 10
				intrigue = 11
				learning = 15
			}
			female = no
			trait = race_dragon
			trait = dragon_wyrm
			trait = quick
			trait = proud
			trait = diligent
			trait = strong
			trait = brave
			flag = race_assigned
			historical = yes			
		}
		new_character = {
			TOW_initialize_adult_character = yes
			wealth = 100
			create_title = {
				tier = DUKE
				landless = yes
				temporary = yes
				culture = green_dragonflight
				name = EMERALD_HOST
				holder = THIS
			}
			create_character = {
				random_traits = no
				name = "Itharius"
				culture = green_dragonflight
				religion = cult_of_the_dreamer
				dynasty = 101005
				age = 7200
				employer = PREV
				attributes = {
					diplomacy = 17
					martial = 15
					stewardship = 16
					intrigue = 14
					learning = 18
				}
				female = no
				trait = race_dragon
				trait = dragon_wyrm
				trait = genius
				trait = proud
				trait = diligent
				trait = brave
				trait = experimenter
				flag = race_assigned
				historical = yes
			}
			new_character = {
				TOW_initialize_adult_character = yes
				add_friend = PREV
			}
			spawn_unit = {
				province = 343
				owner = THIS
				troops = {
					heavy_infantry = { 1000 1000 }
					light_cavalry = { 700 700 }
					dragon_troop = { 25 25 }
				}
				attrition = 0
				can_toggle_looting = no
				reinforces = no
				maintenance = no
				earmark = sunken_temple_dragon_invasion
			}
			c_atal_hakkar = {
				reverse_war = {
					target = ROOT
					casus_belli = claim
					thirdparty = PREV
					infamy = 0
				}
			}
		}
	}
}

#Atal'ai win.
character_event = {
	id = gurubashiwar.16
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ROOT = {
			trait = race_dragon
		}
		FROM = {
			culture = atalai
			OR = {
				trait = race_troll_jungle
				trait = race_troll_forest
				trait = race_troll_ice
				trait = race_troll_sand
				trait = race_troll_dark
			}
			OR = {
				has_landed_title = c_atal_hakkar
				any_realm_character = { has_landed_title = c_atal_hakkar }
			}
			has_global_flag = gurubashiwar_atalai_persist
			NOT = { has_global_flag = gurubashiwar_end }
		}
	}
	
	immediate = {
		FROM = {
			character_event = { id = gurubashiwar.17 }
		}
	}
}

#That first one fires for the attacker, so...
character_event = {
	id = gurubashiwar.17
	desc = EVTDESCGURUB.17 # The meddling green dragons have been beaten back! Now you can truly prepare for the summoning!
	picture = "GFX_evt_hakkar1"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.17 # Hakkar will rise!
		hidden_tooltip = { character_event = { id = gurubashiwar.32 } }
		piety = 100
		prestige = 100
		set_global_flag = gurubashiwar_end
		set_global_flag = gurubashiwar_atalai_win
		any_playable_ruler = {
			limit = {
				ai = no
				OR = {
					trait = race_troll_jungle
					trait = race_troll_forest
					trait = race_troll_ice
					trait = race_troll_sand
					trait = race_troll_dark
					trait = race_troll_zandalari
				}
			}
			narrative_event = { id = gurubashiwar.18 }
		}
	}
}

#Troll players outside the realm notified.
narrative_event = {
	id = gurubashiwar.18
	title = EVTTITLEGURUB.18 # Atal'ai Victory
	desc = EVTDESCGURUB.18 # The trolls of the Atal'ai priesthood have managed to successfully defend themselves against the assault of the Green Dragonflight on their temple. The consequences of this have yet to be seen, but they are bound to continue their efforts to summon their god.
	picture = "GFX_evt_troll_temple"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.18 # Interesting.
	}
}

#Dragons win.
character_event = {
	id = gurubashiwar.19
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ROOT = {
			trait = race_dragon
		}
		FROM = {
			culture = atalai
			OR = {
				trait = race_troll_jungle
				trait = race_troll_forest
				trait = race_troll_ice
				trait = race_troll_sand
				trait = race_troll_dark
			}
			OR = {
				has_landed_title = c_atal_hakkar
				any_realm_character = { has_landed_title = c_atal_hakkar }
			}
			has_global_flag = gurubashiwar_atalai_persist
			NOT = { has_global_flag = gurubashiwar_end }
		}
	}
	
	immediate = {
		hidden_tooltip = { character_event = { id = gurubashiwar.32 } }
		FROM = {
			prestige = -100
			piety = -100
		}
		any_playable_ruler = {
			limit = {
				ai = no
				OR = {
					trait = race_troll_jungle
					trait = race_troll_forest
					trait = race_troll_ice
					trait = race_troll_sand
					trait = race_troll_dark
					trait = race_troll_zandalari
				}
			}
			narrative_event = { id = gurubashiwar.20 }
		}
		c_atal_hakkar = {
			location = {
				set_province_flag = green_dragon_land
			}
		}
	}
}

#Troll players outside the realm notified.
narrative_event = {
	id = gurubashiwar.20
	title = EVTTITLEGURUB.20 # The Sunken Temple
	desc = EVTDESCGURUB.20 # The dragons of Ysera's brood, under the wyrm Eranikus, have conquered the temple of Atal'Hakkar from the Atal'ai priesthood. To prevent any further rituals from being performed, the dragons have sunk the temple in the lake upon which it had been built.
	picture = "GFX_evt_green_dragonflight"
	border = "GFX_event_narrative_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.10 # Interesting.
	}
}

#Hakkar is summoned.
narrative_event = {
	id = gurubashiwar.21
	title = EVTTITLEGURUB.21 # Soulflayer
	desc = EVTDESCGURUB.21 # Hakkar, the Soulflayer, has been summoned onto this world. The power he exudes is overwhelming, and your very blood seems to call out his name. KNEEL. The command issues forth from the mighty feathered serpent. Can you even resist? Could you even possibly disobey a god?
	picture = "GFX_evt_hakkar2"
	border = "GFX_event_narrative_frame_religion"
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = hakkar_summoned
		create_character = {
			age = 7200
			name = "Hakkar"
			has_nickname = nick_the_soulflayer
			attributes = {
				diplomacy = 25
				martial = 40
				stewardship = 25
				intrigue = 25
				learning = 25
			}
			fertility = -1000
			random_traits = no
			female = no
			religion = hakkar
			culture = hakkari
			dynasty = 101004
			historical = yes
			trait = cruel
			trait = brave
			trait = proud
			trait = wroth
			trait = strong
			trait = ambitious
			trait = arbitrary
			trait = zealous
			trait = race_hakkar
			trait = holy_warrior
			trait = impaler
		}
		new_character = {
			TOW_initialize_adult_character = yes
			set_character_flag = race_assigned
			save_event_target_as = hakkar
		}
	}
	
	option = {
		name = EVTOPTGURUB.21.a # Submit to his might.
		random = {
			chance = 10
			modifier = {
				factor = 2
				OR = {
					NOT = { learning = 10 }
					NOT = { martial = 10 }
				}
			}
			modifier = {
				factor = 5
				OR = {
					NOT = { learning = 5 }
					NOT = { martial = 5 }
				}
			}
			death = { death_reason = death_execution }
		}
		new_character = {
			TOW_initialize_adult_character = yes
			if = {
				limit = {
					ROOT = {
						has_landed_title = e_gurubashi
					}
				}
				e_gurubashi = {
					grant_title_no_opinion = PREV
				}
				c_zulgurub_east= {
					grant_title_no_opinion = PREV
				}
			}
			if = {
				limit = {
					ROOT = {
						has_landed_title = d_sunken_swamps
					}
				}
				d_sunken_swamps = {
					grant_title_no_opinion = PREV
				}
				c_atal_hakkar = {
					grant_title_no_opinion = PREV
				}
			}
		}
		any_playable_ruler = {
			limit = {
				ai = no
			}
			narrative_event = { id = gurubashiwar.22 }
		}
	}
	option = {
		trigger = {
			learning = 25
			trait = ambitious
			NOT = { trait = zealous }
		}
		name = EVTOPTGURUB.21.b # Someone will submit. And it won't be me.
		new_character = {
			TOW_initialize_adult_character = yes
			imprison = ROOT
		}
		set_global_flag = hakkar_godbreaker
		set_character_flag = hakkar_godbreaker
		add_trait = immortal
		add_character_modifier = { name = hakkar_godbreaker duration = -1 }
		give_nickname = nick_the_godbreaker
		save_event_target_as = godbreaker
		prestige = 500
		piety = -500
		any_playable_ruler = {
			limit = {
				ai = no
			}
			narrative_event = { id = gurubashiwar.23 }
		}
	}
}

#Any players are notified of Hakkar being summoned.
narrative_event = {
	id = gurubashiwar.22
	title = EVTTITLEGURUB.20 # Soulflayer
	desc = EVTDESCGURUB.22 # The troll [From.GetBestName] has succeeded in summoning his dread god, Hakkar, onto this world. The consequences of this are yet unknown, but it is without a doubt that this will not end well for anyone.
	picture = "GFX_evt_hakkar2"
	border = "GFX_event_narrative_frame_religion"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.22 # Worrying.
	}
}

#Any players are notified of Hakkar being broken.
narrative_event = {
	id = gurubashiwar.23
	title = EVTTILEGURUB.23 # Soulflayed
	desc = EVTDESCGURUB.23 # The troll [From.GetBestName] has succeeded in summoning the dread god, Hakkar, onto this world... and then proceeded to entrap the Loa of Blood and now "breaks" him. Through this profane act, [From.GetBestName] is gaining incredible quantities of power, and might soon become unstoppable.
	picture = "GFX_evt_hakkar2"
	border = "GFX_event_narrative_frame_religion"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.23 # What.
	}
}

#Godbreaker dies
character_event = {
	id = gurubashiwar.24
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		event_target:godbreaker = {
			character = ROOT
		}
	}
	
	immediate = {
		event_target:hakkar = {
			banish = yes
			inherit = ROOT
		}
	}
}

#Hakkar is freed from jail for absolutely any reason after being broken.
character_event = {
	id = gurubashiwar.25
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = hakkar_godbreaker
		trait = race_hakkar
		host = {
			character = event_target:godbreaker
		}
	}
	
	immediate = {
		set_character_flag = challenged_for_title
		host = {
			narrative_event = { id = gurubashiwar.26 }
			prestige = -500
		}
		any_playable_ruler = {
			limit = {
				ai = no
			}
			narrative_event = { id = gurubashiwar.27 }
		}
	}
}

#Godbreaker informed.
narrative_event = {
	id = gurubashiwar.26
	title = EVTTITLEGURUB.26 # Hakkar's Vengeance
	desc = EVTDESCGURUB.26 # Hakkar somehow has been freed from your binding and now heads for you to regain his power and get revenge. Steel yourself, for the confrontation is nigh!
	picture = "GFX_evt_hakkar2"
	border = "GFX_event_narrative_frame_religion"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.26 # I broke you once, I will break you again!
		set_character_flag = duel_cannot_flee
		set_character_flag = duel_cannot_surrender
		FROM = {
			set_character_flag = duel_cannot_flee
			set_character_flag = duel_cannot_surrender
			set_character_flag = duel_hakkar
			character_event = { id = duel.1 }
		}
	}
}

#Any players informed.
narrative_event = {
	id = gurubashiwar.27
	title = EVTTITLEGURUB.26 # Hakkar's Vengeance
	desc = EVTDESCGURUB.27 # Hakkar, the dreaded Loa of Blood, has somehow escaped from the binds of [godbreaker.GetBestName] and now heads for a final confrontation in order to reacquire his power from the pretender. Either way, the consequence will not be to anyone's benefit.
	picture = "GFX_evt_hakkar2"
	border = "GFX_event_narrative_frame_religion"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.27 # Worrying.
	}
}

#If Hakkar is imprisoned by someone other than the godbreaker, he just dies.
character_event = {
	id = gurubashiwar.28
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		ROOT = {
			trait = race_hakkar
		}
		event_target:godbreaker = {
			NOT = { character = FROM }
		}
	}
	
	immediate = {
		ROOT = { death = { death_reason = death_execution } }
	}
}

#Infinite intervention (Civil War)
character_event = {
	id = gurubashiwar.29
	desc = EVTDESCGURUB.29 # Strange grey dragons have started appearing out of nowhere, and now attack your enemies! While they do not attempt to contact you, or respond to your attempts at communication, they mostly ignore your own warriors and seem to be on your side of the war.
	picture = "EVT_gfx_infinite_dragon"
	border = "GFX_event_normal_frame_war"
	
	mean_time_to_happen = {
		years = 1000 # Need to test for how unlikely it is.
		modifier = {
			factor = 0.5
			has_game_rule = {
				name = troll_wars_events
				value = alternate
			}
		}
		modifier = {
			factor = 0.1
			has_game_rule = {
				name = infinite_dragons
				value = more
			}
		}
	}
	
	trigger = {
		NOR = {	
			has_global_flag = gurubashiwar_rebel_win
			has_global_flag = gurubashiwar_emp_win
			has_global_flag = gurubashiwar_infinites
		}
		has_global_flag = gurubashiwar_dow
		has_landed_title = e_gurubashi
		any_war = {
			using_cb = overthrow_ruler
			war_score = 51
		}
		NOT = {
			has_game_rule = {
				name = infinite_dragons
				value = off
			}
		}
	}
	
	immediate = {
		set_global_flag = gurubashiwar_infinites
		create_character = {
			age = 360
			religion = cult_of_the_infinite
			culture = infinite_dragonflight
			dynasty = 101010
			attributes = {
				martial = 19
			}
			random_traits = yes
			trait = race_dragon_infinite
			trait = dragon_dragon
			flag = race_assigned
		}
		new_character = {
			TOW_initialize_adult_character = yes
			save_event_target_as = gurubashiwar_infinite_leader
			create_title = {
				tier = DUKE
				temporary = yes
				culture = infinite_dragonflight
				name = INFINITE_INTERVENTION
				holder = THIS
			}
			ROOT = {
				location = {
					save_event_target_as = infinite_spawn
				}
				spawn_unit = {
					province = event_target:infinite_spawn
					owner = PREV
					leader = PREV
					disband_on_peace = yes
					troops = {
						dragon_troop = { 20 20 }
						heavy_infantry = { 900 900 }
						light_cavalry = { 550 550 }
					}
					attrition = 0
					maintenance = no
					reinforces = yes
				}
			}
			add_alliance = { 
				who = ROOT	
				years = 100 
			}
		}
	}
	
	option = {
		name = EVTOPTGURUB.29 # Unexpected. But not unwelcome.
		hidden_tooltip = {
			any_playable_ruler = {
				limit = {
					ai = no
					OR = {
						has_character_flag = gurubashiwar_rebel_leader
						top_liege = {
							has_character_flag = gurubashiwar_rebel_leader
						}
					}
				}
				character_event = { id = gurubashiwar.30 }
			}
			any_playable_ruler = {
				limit = {
					ai = no
					top_liege = {
						has_landed_title = e_gurubashi
					}
				}
				character_event = { id = gurubashiwar.31 }
			}
		}
	}
}

#Troll rebels informed.
character_event = {
	id = gurubashiwar.30
	desc = EVTDESCGURUB.30 # As if the emperor's foul devotion to the Soulflayer wasn't enough, now he reveals a new weapon: mysterious grey dragons who have come from seemingly nowhere! This war is about to become even bloodier, which will only strengthen Hakkar.
	picture = "EVT_gfx_infinite_dragon"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.30 # We must stay strong!
	}
}

#Player imperial vassal informed.
character_event = {
	id = gurubashiwar.31
	desc = EVTDESCGURUB.31 # The emperor's power is even greater and more glorious than you could have imagined! Dragons, though of a kind you've never heard of, fight on his side against the traitorous rebels! Truly a sign of Hakkar's might, that even dragons can be bent towards his bloody purpose.
	picture = "EVT_gfx_infinite_dragon"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.1 # Blood for the Blood Loa!
	}
}

#Infinites removed.
character_event = {
	id = gurubashiwar.32
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		event_target:gurubashiwar_infinite_leader = {
			death = { death_reason = death_murder_unknown killer = ROOT }
		}
	}
}

#Infinite intervention (Sunken Temple)
character_event = {
	id = gurubashiwar.33
	desc = EVTDESCGURUB.33 # Strange grey dragons have started appearing out of nowhere, and now attack your enemies! While they do not attempt to contact you, or respond to your attempts at communication, they mostly ignore your own warriors and seem to be on your side of the war.
	picture = "EVT_gfx_infinite_dragon"
	border = "GFX_event_normal_frame_war"
	
	mean_time_to_happen = {
		years = 1000 # Need to test for how unlikely it is.
		modifier = {
			factor = 0.5
			has_game_rule = {
				name = troll_wars_events
				value = alternate
			}
		}
		modifier = {
			factor = 0.1
			has_game_rule = {
				name = infinite_dragons
				value = more
			}
		}
	}
	
	trigger = {
		NOR = {	
			has_global_flag = gurubashiwar_end
			has_global_flag = gurubashiwar_infinites2
		}
		has_global_flag = gurubashiwar_atalai_war
		OR = {
			has_landed_title = c_atal_hakkar
			any_realm_character = { has_landed_title = c_atal_hakkar }
		}
		any_war = {
			using_cb = claim
			war_score = 51
		}
		NOT = {
			has_game_rule = {
				name = infinite_dragons
				value = off
			}
		}
	}
	
	immediate = {
		set_global_flag = gurubashiwar_infinites2
		create_character = {
			age = 410
			religion = cult_of_the_infinite
			culture = infinite_dragonflight
			dynasty = 101010
			attributes = {
				martial = 19
			}
			random_traits = yes
			trait = race_dragon_infinite
			trait = dragon_dragon
			flag = race_assigned
		}
		new_character = {
			TOW_initialize_adult_character = yes
			save_event_target_as = gurubashiwar_infinite_leader
			create_title = {
				tier = DUKE
				temporary = yes
				culture = infinite_dragonflight
				name = INFINITE_INTERVENTION
				holder = THIS
			}
			ROOT = {
				location = {
					save_event_target_as = infinite_spawn
				}
				spawn_unit = {
					province = event_target:infinite_spawn
					owner = PREV
					leader = PREV
					disband_on_peace = yes
					troops = {
						dragon_troop = { 20 20 }
						heavy_infantry = { 900 900 }
						light_cavalry = { 550 550 }
					}
					attrition = 0
					maintenance = no
					reinforces = yes
				}
			}
			add_alliance = { 
				who = ROOT	
				years = 100 
			}
		}
	}
	
	option = {
		name = EVTOPTGURUB.29 # Unexpected. But not unwelcome.
		hidden_tooltip = {
			any_playable_ruler = {
				limit = {
					ai = no
					top_liege = {
						OR = {
							has_landed_title = c_atal_hakkar
							any_realm_character = { has_landed_title = c_atal_hakkar }
						}
					}
				}
				character_event = { id = gurubashiwar.34 }
			}
		}
	}
}

#Player atal'ai vassal informed.
character_event = {
	id = gurubashiwar.34
	desc = EVTDESCGURUB.34 # Though Ysera's spawn attempt to stop the summoning of the great Soulflayer, other dragons seem to disagree. Strange grey dragons have appeared and, without a word, are fighting against their green counterparts. A sign from Hakkar, perhaps?
	picture = "EVT_gfx_infinite_dragon"
	border = "GFX_event_normal_frame_war"
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTGURUB.1 # Blood for the Blood Loa!
	}
}