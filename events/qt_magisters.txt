namespace = qtmags

# these first ones are to populate the magisters

character_event = { #force the AI to join a society
	id = qtmags.1 # TUTOSOCI.110
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				society_member_of = magisters
				society_rank <= 3
				society_can_rank_up = yes
			}
			random_list = {
				75 = {}
				25 = {
					society_rank_up = 1					
				}
			}
		}
		any_courtier = {
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
				can_join_society = magisters
			}
			character_event = { id = TUTOSOCI.111 }
		# }
		if = { #force the joining event on AI
			limit = {
				ai = yes
				prisoner = no
				NOT = { trait = incapable }
				is_adult = yes
				is_in_society = no
				controls_religion = no
				block_general_event_trigger = no
				can_join_society = magisters
			}
			character_event = { id = qtmags.2 } #TUTOSOCI.111
		}
	}
}

character_event = { #AI join event
	id = qtmags.2
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		random_list = {
			90 = {
			}
			10 = {
				modifier = {
					factor = 2
					trait = arcanist
				}
				modifier = {
					factor = 4
					trait = mage
				}
				join_society = magisters
				random_list = {
					75 = {
						modifier = {
							factor = 0
							society_influence >= 30
						}
						add_mission_succeed_influence_effect = yes
					}
					25 = {
					}
				}
				if = {
					limit = {
						NOT = {
							society = {
								any_society_member = {
									is_society_grandmaster = yes
								}
							}
						}
					}
					set_society_grandmaster = yes
				}
			}
		}
	}
}

#Quests
character_event = {
    id = qtmags.3
    hide_window = yes

    is_triggered_only = yes
    
	is_in_society = yes

	trigger = {
		society_member_of = magisters
		has_any_quest = no
		NOT = { has_character_modifier = quest_cooldown_timer }
		NOT = { is_inaccessible_trigger = yes }
		prisoner = no
		society = 
			any_society_member = {
				NOT = { character = ROOT }
				prisoner = no
				opinion = { who = ROOT value = 0 }
			}
		}
	}

    immediate = {
    	random_list = {
    		20 = {
    			society = {
    				random_society_member = {
    					limit = { 	
							NOT = { character = ROOT }
							prisoner = no
							opinion = { who = ROOT value = 0 }
    					}
    					save_event_target_as = quest_collaborator
    				}
    			}
    		}
    		40 = {
    			trigger = {
    				society = {
    					any_society_member = {
    						NOT = { character = ROOT }
    						prisoner = no
							opinion = { who = ROOT value = 0 }
							same_realm = ROOT
    					}
    				}
    			}
    			society = {
    				random_society_member = {
    					limit = { 	
    						NOT = { character = ROOT }
    						prisoner = no
							opinion = { who = ROOT value = 0 }
							same_realm = ROOT
    					}
    					save_event_target_as = quest_collaborator
    				}
    			}
    		}
		}

    	random_list = {
			2 = { # Research
				event_target:quest_collaborator = { character_event = { id = qtmags.4 days = 7 random = 7 } }
			}
			
			2 = { # Retrieve Item
			
			}
			
			2 = { # Take down spellcaster
			
			}
			
			1 = { # AI bypass
				modifier = {
					factor = 0
					ai = no
				}
				random_list = {
					70 = {
						modifier = {
							factor = 0.9
							society_influence >= 30
						}
						modifier = {
							factor = 0.9
							society_influence >= 40
						}
						modifier = {
							factor = 0.8
							society_influence >= 50
						}
						modifier = {
							factor = 0.7
							society_influence >= 70
						}
						modifier = {
							factor = 0.6
							society_influence >= 80
						}
						modifier = {
							factor = 0.5
							society_influence >= 90
						}
						add_mission_succeed_influence_effect = yes
					}
					30 = {
						add_mission_fail_influence_effect = yes
					}
				}
			}
			
			2 = {
				modifier = {
					factor = 0
					ai = no
				}
			}
    	}
    }
}

character_event = {
    id = qtmags.4
    hide_window = yes
    is_triggered_only = yes
    immediate = { FROM = { society_quest_event = { id = qtmags.5 days = 7 random = 7 } } }
}

society_quest_event = {
    id = TUTOSOCI.141
    desc = EVTDESC_TUTOSOCI_141

    is_triggered_only = yes
   
    option = { 
		name = ACCEPT
		set_quest = quest_tutorial_quest_1

	}

	option = {
		name = DECLINE
		custom_tooltip = { text = decline_quest_tooltip }

		add_character_modifier = {
			name = quest_cooldown_timer
			hidden = yes
			days = 1000
		}

		ai_chance = { factor = 0 }
	}
}