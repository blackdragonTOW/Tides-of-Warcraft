namespace = helfm

character_event = {
	id = helfm.1
	hide_window = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		OR = {
			trait = race_high_elf
			trait = race_blood_elf
			trait = race_wretched
		}
		NOR = {
			trait = race_undead_scourge
			trait = race_undead_forsaken
		}
		is_landed = yes
		OR = {
			location = {
				OR = {
					region = world_eversong_woods
					region = world_ghostlands
				}
			}
			any_liege = {
				has_landed_title = k_silvermoon
				OR = {
					trait = race_high_elf
					trait = race_blood_elf
					trait = race_wretched
				}
				NOR = {
					trait = race_undead_scourge
					trait = race_undead_forsaken
					religion = burning_legion
					religion = old_gods
					religion = twilights_hammer
					religion = cult_of_the_infinite
					religion = cult_of_the_destroyer
					religion = emerald_nightmare
					religion = lich_king
				}
			}
		}
		NOT = { has_character_modifier = realm_magic_counter }
	}
	
	immediate = {
		set_variable = { which = realm_mana value = 0 }
		trigger_switch = {
			on_trigger = real_tier
			baron = { set_variable = { which = realm_mana value = 50 } }
			count = { set_variable = { which = realm_mana value = 150 } }
			duke = { set_variable = { which = realm_mana value = 300 } }
			king = { set_variable = { which = realm_mana value = 550 } }
			emperor = { set_variable = { which = realm_mana value = 700 } }
		}
		add_character_modifier = { modifier = realm_magic_counter duration = -1 }
	}
}

character_event = {
	id = helfm.2
	hide_window = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		OR = {
			trait = race_high_elf
			trait = race_blood_elf
			trait = race_wretched
		}
		OR = {
			trait = race_undead_scourge
			trait = race_undead_forsaken
			is_landed = no
		}
		has_character_modifier = realm_magic_counter
	}
	
	immediate = {
		remove_character_modifier = realm_magic_counter
	}
}

character_event = {
	id = helfm.3
	hide_window = yes
	
	mean_time_to_happen = {
		months = 3
	}
	
	trigger = {
		has_character_modifier = realm_magic_counter
		NOR = {
			has_global_flag = sunwell_corrupted
			has_global_flag = sunwell_destroyed
		}
	}
	
	immediate = {
		trigger_switch = {
			on_trigger = real_tier
			baron = { change_variable = { which = realm_mana value = 100 } }
			count = { change_variable = { which = realm_mana value = 250 } }
			duke = { change_variable = { which = realm_mana value = 400 } }
			king = { change_variable = { which = realm_mana value = 650 } }
			emperor = { change_variable = { which = realm_mana value = 1000 } }
		}
	}
}

character_event = {
	id = helfm.4
	hide_window = yes
	
	mean_time_to_happen = {
		days = 45
	}
	
	trigger = {
		has_character_modifier = realm_magic_counter
	}
	
	immediate = {
		any_demesne_title = {
			limit = {
				lower_tier_than = DUKE
			}
			ROOT = { subtract_variable = { which = realm_mana value = 50 } }
			any_province_holding = {
				limit = {
					owner = { character = ROOT }
					OR = {
						has_building = ca_battlemage_barracks_1
						has_building = ct_battlemage_barracks_1
						has_building = tp_battlemage_barracks_1
					}
				}
				ROOT = { subtract_variable = { which = realm_mana value = 5 } }
			}
			any_province_holding = {
				limit = {
					owner = { character = ROOT }
					OR = {
						has_building = ca_battlemage_barracks_2
						has_building = ct_battlemage_barracks_2
						has_building = tp_battlemage_barracks_2
					}
				}
				ROOT = { subtract_variable = { which = realm_mana value = 10 } }
			}
			any_province_holding = {
				limit = {
					owner = { character = ROOT }
					OR = {
						has_building = ca_battlemage_barracks_3
						has_building = ca_battlemage_barracks_4
						has_building = ct_battlemage_barracks_3
						has_building = ct_battlemage_barracks_4
						has_building = tp_battlemage_barracks_3
						has_building = tp_battlemage_barracks_4
					}
				}
				ROOT = { subtract_variable = { which = realm_mana value = 15 } }
			}
			any_province_holding = {
				limit = {
					owner = { character = ROOT }
					OR = {
						has_building = ct_construct_market_1
					}
				}
				ROOT = { subtract_variable = { which = realm_mana value = 5 } }
			}
			any_province_holding = {
				limit = {
					owner = { character = ROOT }
					OR = {
						has_building = ct_construct_market_2
					}
				}
				ROOT = { subtract_variable = { which = realm_mana value = 10 } }
			}
		}
	}
}

narrative_event = {
	id = helfm.5
	title = EVTTITLEHELFM.5 # Fall of the Sunwell
	desc = EVTDESCHELFM.5 # Today the Sunwell has been corrupted by the forces of [From.GetTitledName], perverting the once glorious fountain of arcane magic into a perversion of what it once was. A shadow has fallen upon Quel'Thalas, and its effects have yet to manifest.
	picture = GFX_evt_sunwell
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}