namespace = threehammers

#Start for the two people coming in from Troll Wars
character_event = {
	id = threehammers.1
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = e_khaz_modan
		trait = race_dwarf
		NOR = {
			dynasty = 100803
			dynasty = 100802
			dynasty = 100801
		}
		NOT = { prestige = 500 }
		has_global_flag = trollwars_bookmark
		NOT = {
			has_game_rule = {
				name = three_hammers_events
				value = off
			}
		}
		any_vassal = {
			higher_tier_than = COUNT
			dynasty = 100803
		}
		any_vassal = {
			higher_tier_than = COUNT
			dynasty = 100802
		}
		any_vassal = {
			higher_tier_than = COUNT
			dynasty = 100801
		}
		NOT = { has_global_flag = 3hammer_start }
	}
	
	immediate = {
		set_global_flag = 3hammer_start
		current_heir = {
			if = {
				limit = {
					dynasty = ROOT
				}
				save_event_target_as = 3h_heir
			}
		}
		most_popular_vassal = {
			limit = {
				higher_tier_than = COUNT
				dynasty = 100803
			}
			save_event_target_as = 3h_wildhammer
			narrative_event = { id = threehammers.3 }
		}
		most_popular_vassal = {
			limit = {
				higher_tier_than = COUNT
				dynasty = 100802
			}
			save_event_target_as = 3h_darkiron
			narrative_event = { id = threehammers.3 }
		}
		most_popular_vassal = {
			limit = {
				higher_tier_than = COUNT
				dynasty = 100801
			}
			save_event_target_as = 3h_bronzebeard
			narrative_event = { id = threehammers.3 }
		}
	}
}

#Start for the bookmark
character_event = {
	id = threehammers.2
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = e_khaz_modan
		has_global_flag = threehamers_bookmark
		NOT = {
			has_game_rule = {
				name = three_hammers_events
				value = off
			}
		}
		NOT = { has_global_flag = 3hammer_start }
	}
	
	immediate = {
		set_global_flag = 3hammer_start
		current_heir = {
			if = {
				limit = {
					dynasty = ROOT
				}
				save_event_target_as = 3h_heir
			}
		}
		most_popular_vassal = {
			limit = {
				higher_tier_than = COUNT
				dynasty = 100803
			}
			save_event_target_as = 3h_wildhammer
			narrative_event = { id = threehammers.3 }
		}
		most_popular_vassal = {
			limit = {
				higher_tier_than = COUNT
				dynasty = 100802
			}
			save_event_target_as = 3h_darkiron
			narrative_event = { id = threehammers.3 }
		}
		most_popular_vassal = {
			limit = {
				higher_tier_than = COUNT
				dynasty = 100801
			}
			save_event_target_as = 3h_bronzebeard
			narrative_event = { id = threehammers.3 }
		}
	}
}

#The visible start
narrative_event = {
	id = threehammers.3
	title = EVTTITLE3HAMMER.3 # Death of a [From.GetTitle]
	desc = EVTDESC3HAMMER.3 # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. Perhaps it is time for a stronger ruler to step up and sieze the throne, to best steer the fate of the dwarves towards glory. Someone like you.
	picture = GFX_evt_death
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
			}
		}
		name = EVTOPT3HAMMER.3a # Yes, it must be done.
		if = {
			limit = { character = event_target:3h_wildhammer }
			set_global_flag = 3h_wildhammer_join
		}
		if = {
			limit = { character = event_target:3h_darkiron }
			set_global_flag = 3h_darkiron_join
		}
		if = {
			limit = { character = event_target:3h_bronzebeard }
			set_global_flag = 3h_bronzebeard_join
		}
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 50
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
			}
		}
		name = EVTOPT3HAMMER.3b # No, that is not the right way.
		if = {
			limit = { character = event_target:3h_wildhammer }
			clear_event_target = event_target:3h_wildhammer
		}
		if = {
			limit = { character = event_target:3h_darkiron }
			clear_event_target = event_target:3h_darkiron
		}
		if = {
			limit = { character = event_target:3h_bronzebeard }
			clear_event_target = event_target:3h_bronzebeard
		}
	}
	
	after = {
		if = {
			limit = {
				character = event_target:3h_bronzebeard
			}
			character_event = { id = threehammers.4 }
		}
	}
}

character_event = {
	id = threehammers.4
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				OR = {
					has_global_flag = 3h_wildhammer_join
					has_global_flag = 3h_darkiron_join
					has_global_flag = 3h_bronzebeard_join
				}
			}
			destroy_landed_title = e_khaz_modan
			if = {
				limit = {
					has_global_flag = 3h_bronzebeard_join
				}
				if = {
					limit = {
						has_global_flag = 3h_darkiron_join
					}
					war = {
						target = event_target:3h_darkiron
						casus_belli = 3hammer_war
					}
				}
				if = {
					limit = {
						has_global_flag = 3h_wildhammer_join
					}
					war = {
						target = event_target:3h_darkiron
						casus_belli = 3hammer_war
					}
				}
			}
			if = {
				limit = {
					has_global_flag = 3h_darkiron_join
				}
				if = {
					limit = {
						has_global_flag = 3h_wildhammer_join
					}
					war = {
						target = event_target:3h_darkiron
						casus_belli = 3hammer_war
					}
				}
			}
			event_target:3h_heir = { narrative_event = { id = threehammers.5 } }
		}
		if = {
			limit = {
				NOT = { has_global_flag = 3h_wildhammer_join }
				NOT = { has_global_flag = 3h_darkiron_join }
				NOT = { has_global_flag = 3h_bronzebeard_join }
			}
			set_global_flag = 3hammer_end
		}
	}
}

narrative_event = {
	id = threehammers.5
	title = EVTTITLE3HAMMER.3 # Death of a [From.GetTitle]
	desc = {
		trigger = {
			has_global_flag = 3h_bronzebeard_join
			NOT = {	has_global_flag = 3h_wildhammer_join }
			NOT = {	has_global_flag = 3h_darkiron_join }
		}
		text = EVTDESC3HAMMER.5a # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_bronzebeard.GetFullName] has risen up to take the throne for [event_target:3h_bronzebeard.GetHerselfHimself]. Will your defend you claim, or accept the fall of your clan?
	}
	desc = {
		trigger = {
			NOT = { has_global_flag = 3h_bronzebeard_join }
			has_global_flag = 3h_wildhammer_join
			NOT = {	has_global_flag = 3h_darkiron_join }
		}
		text = EVTDESC3HAMMER.5b # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_wildhammer.GetFullName] has risen up to take the throne for [event_target:3h_wildhammer.GetHerselfHimself]. Will you defend your claim, or accept the fall of your clan?
	}
	desc = {
		trigger = {
			NOT = { has_global_flag = 3h_bronzebeard_join }
			NOT = {	has_global_flag = 3h_wildhammer_join }
			has_global_flag = 3h_darkiron_join
		}
		text = EVTDESC3HAMMER.5c # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_darkiron.GetFullName] has risen up to take the throne for [event_target:3h_darkiron.GetHerselfHimself]. Will you defend your claim, or accept the fall of your clan?
	}
	desc = {
		trigger = {
			has_global_flag = 3h_bronzebeard_join
			has_global_flag = 3h_wildhammer_join
			NOT = {	has_global_flag = 3h_darkiron_join }
		}
		text = EVTDESC3HAMMER.5d # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_bronzebeard.GetFullName] and [event_target:3h_wildhammer.GetFullName] have risen up and now fight for the throne. Will you defend your claim, or accept the fall of your clan?
	}
	desc = {
		trigger = {
			has_global_flag = 3h_bronzebeard_join
			NOT = { has_global_flag = 3h_wildhammer_join }
			has_global_flag = 3h_darkiron_join
		}
		text = EVTDESC3HAMMER.5e # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_bronzebeard.GetFullName] and [event_target:3h_darkiron.GetFullName] have risen up and now fight for the throne. Will you defend your claim, or accept the fall of your clan?
	}
	desc = {
		trigger = {
			NOT = { has_global_flag = 3h_bronzebeard_join }
			has_global_flag = 3h_wildhammer_join
			has_global_flag = 3h_darkiron_join
		}
		text = EVTDESC3HAMMER.5f # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_wildhammer.GetFullName] and [event_target:3h_darkiron.GetFullName] have risen up and now fight for the throne. Will you defend your claim, or accept the fall of your clan?
	}
	desc = {
		trigger = {
			has_global_flag = 3h_bronzebeard_join
			has_global_flag = 3h_wildhammer_join
			has_global_flag = 3h_darkiron_join
		}
		text = EVTDESC3HAMMER.5g # The late [From.GetTitledName] was not a particularly notable monarch, having done little in service of Khaz Modan. What is worrying, however, is that [event_target:3h_bronzebeard.GetFullName], [event_target:3h_wildhammer.GetFullName] and [event_target:3h_darkiron.GetFullName] have risen up and now fight for the throne. Will you defend your claim, or accept the fall of your clan?
	}
	picture = GFX_evt_death
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				factor = 0.5
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
			}
		}
		name = EVTOPT3HAMMER.5a # No, our time has passed.
		clear_event_target = event_target:3h_heir
		if = {
			limit = {
				has_global_flag = 3h_bronzebeard_join
			}
			set_defacto_liege = event_target:3h_bronzebeard
		}
		if = {
			limit = {
				NOT = { has_global_flag = 3h_bronzebeard_join }
				has_global_flag = 3h_wildhammer_join
			}
			set_defacto_liege = event_target:3h_wildhammer
		}
		if = {
			limit = {
				NOT = { has_global_flag = 3h_bronzebeard_join }
				NOT = { has_global_flag = 3h_wildhammer_join }
				has_global_flag = 3h_darkiron_join
			}
			set_defacto_liege = event_target:3h_darkiron
		}
		if = {
			limit = {
				OR = {
					AND = {
						has_global_flag = 3h_bronzebeard_join
						NOT = { has_global_flag = 3_wildhammer_join }
						NOT = { has_global_flag = 3_darkiron_join }
					}
					AND = {
						NOT = { has_global_flag = 3h_bronzebeard_join }
						has_global_flag = 3_wildhammer_join
						NOT = { has_global_flag = 3_darkiron_join }
					}
					AND = {
						NOT = { has_global_flag = 3h_bronzebeard_join }
						NOT = { has_global_flag = 3_wildhammer_join }
						has_global_flag = 3_darkiron_join
					}
				}
			}
			set_global_flag = 3hammer_end
		}
	}
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				factor = 50
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
			}
		}
		name = EVTOPT3HAMMER.5b # This is MY realm!
		set_global_flag = 3h_heir_join
		if = {
			limit = {
				has_global_flag = 3h_bronzebeard_join
			}
			event_target:3h_bronzebeard = {
				war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
			}
		}
		if = {
			limit = {
				has_global_flag = 3h_darkiron_join
			}
			event_target:3h_darkiron = {
				war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
			}
		}
		if = {
			limit = {
				has_global_flag = 3h_wildhammer_join
			}
			event_target:3h_wildhammer = {
				war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
			}
		}
	}
	
	after = {
		if = {
			limit = {
				OR = {
					AND = {
						has_global_flag = 3h_bronzebeard_join
						has_global_flag = 3h_wildhammer_join
					}
					AND = {
						has_global_flag = 3h_bronzebeard_join
						has_global_flag = 3h_darkiron_join
					}
					AND = {
						has_global_flag = 3h_bronzebeard_join
						has_global_flag = 3h_heir_join
					}
					AND = {
						has_global_flag = 3h_wildhammer_join
						has_global_flag = 3h_darkiron_join
					}
					AND = {
						has_global_flag = 3h_wildhammer_join
						has_global_flag = 3h_heir_join
					}
					AND = {
						has_global_flag = 3h_darkiron_join
						has_global_flag = 3h_heir_join
					}
				}
			}
			any_playable_ruler = {
				limit = {
					OR = {
						trait = race_dwarf
						trait = race_gnome
					}
					NOR = {
						character = event_target:3h_bronzebeard
						character = event_target:3h_darkiron
						character = event_target:3h_wildhammer
						character = event_target:3h_heir
					}
				}
				narrative_event = { id = threehammers.6 }
			}
		}
	}
}

character_event = {
	id = threehammers.6
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		has_global_flag = 3hammer_start
		NOT = { has_global_flag = 3hammer_end }
		OR = {
			character = event_target:3h_bronzebeard
			character = event_target:3h_wildhammer
			character = event_target:3h_darkiron
			character = event_target:3h_heir
		}
	}
	
	immediate = {
		if = {
			limit = {
				character = event_target:3h_bronzebeard
			}
			clear_event_target = event_target:3h_bronzebeard
			current_heir = {
				save_event_target_as = 3h_bronzebeard
			}
		}
		if = {
			limit = {
				character = event_target:3h_wildhammer
			}
			clear_event_target = event_target:3h_wildhammer
			current_heir = {
				save_event_target_as = 3h_wildhammer
			}
		}
		if = {
			limit = {
				character = event_target:3h_darkiron
			}
			clear_event_target = event_target:3h_darkiron
			current_heir = {
				save_event_target_as = 3h_darkiron
			}
		}
		if = {
			limit = {
				character = event_target:3h_heir
			}
			clear_event_target = event_target:3h_heir
			current_heir = {
				save_event_target_as = 3h_heir
			}
		}
	}
}

narrative_event = {
	id = threehammers.7
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.7 # A great civil war has engulfed the dwarven realm of Khaz Modan. The clans have risen against their king and now fight for dominance of their mountainous homeland.
	picture = GFX_evt_dwarves
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#The uneasy truce
character_event = {
	id = threehammers.8
	hide_window = yes
	
	mean_time_to_happen = {
		years = 5 # need to balance
	}
	
	trigger = {
		has_global_flag = 3hammer_start
		NOT = { has_global_flag = 3hammer_end }
		NOT = { has_global_flag = 3hammer_interwar }
		OR = {
			character = event_target:3h_bronzebeard
			character = event_target:3h_wildhammer
			character = event_target:3h_darkiron
			character = event_target:3h_heir
		}
	}
	
	immediate = {
		set_global_flag = 3hammer_interwar
		any_playable_ruler = {
			limit = {
				OR = {
					trait = race_dwarf
					trait = race_gnome
				}
			}
			narrative_event = { id = threehammers.9 }
		}
	}
}

narrative_event = {
	id = threehammers.9
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.9 # The civil war consuming Khaz Modan has ground down to a halt as sides are forced into an uneasy truce. Tensions are sure to rise again though.
	picture = GFX_evt_dwarves
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Phase two
narrative_event = {
	id = threehammers.10
	title = EVTTITLE3HAMMER.10 # Revenge
	desc = EVTDESC3HAMMER.10 # The hostilities may have died down, but you still hold on to fact that you couldn't claim Khaz Modan. Perhaps the time has come to finally claim Ironforge for yourself?
	picture = GFX_evt_rival_rulers
	border = GFX_event_narrative_frame_war
	
	mean_time_to_happen = {
		years = 5
	}
	
	trigger = {
		k_ironforge = {
			holder_scope = {
				trait = race_dwarf
			}
		}
		has_global_flag = 3hammer_start
		has_global_flag = 3hammer_interwar
		NOT = { has_global_flag = 3hammer_end }
		NOT = { has_global_flag = 3hammer_phasetwo }
		OR = {
			AND = {
				character = event_target:3h_darkiron
				NOT = { has_global_flag = 3h_darkiron_refuse_phasetwo }
			}
			AND = {
				character = event_target:3h_wildhammer
				NOT = { has_global_flag = 3h_wildhammer_refuse_phasetwo }
				NOT = { has_global_flag = 3h_wildhammer_migrate }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 0.5
			}
		}
		name = EVTOPT3HAMMER.10a # The time has come! We march on Ironforge!
		set_global_flag = 3hammer_phasetwo
		k_ironforge = {
			holder_scope = {
				reverse_war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
				narrative_event = { id = threehammers.11 }
			}
		}
		if = {
			limit = {
				character = event_target:3h_darkiron
				NOT = { has_global_flag = 3h_wildhammer_migrate }
			}
			event_target:3h_wildhammer = {
				narrative_event = { id = threehammers.12 }
			}
		}
		if = {
			limit = {
				character = event_target:3h_wildhammer
			}
			event_target:3h_darkiron = {
				narrative_event = { id = threehammers.12 }
			}
		}
		any_playable_ruler = {
			limit = {
				OR = {
					trait = race_dwarf
					trait = race_gnome
				}
				NOR = {
					character = event_target:3h_bronzebeard
					character = event_target:3h_darkiron
					character = event_target:3h_wildhammer
					character = event_target:3h_heir
				}
			}
			narrative_event = { id = threehammers.13 }
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 50
			}
		}
		name = EVTOPT3HAMMER.10b # No, let old hatreds die.
		prestige = -50
		if = {
			limit = {
				character = event_target:3h_darkiron
			}
			set_global_flag = 3h_darkiron_refuse_phasetwo
		}
		if = {
			limit = {
				character = event_target:3h_wildhammer
			}
			set_global_flag = 3h_wildhammer_refuse_phasetwo
		}
	}
	
	after = {
		if = {
			limit = {
				has_global_flag = 3h_darkiron_refuse_phasetwo
				OR = {
					has_global_flag = 3h_wildhammer_refuse_phasetwo
					has_global_flag = 3h_wildhammer_migrate
				}
			}
			set_global_flag = 3hammer_end
		}
	}
}

narrative_event = {
	id = threehammers.11
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.11 # [From.GetTitledName] is still holding a grudge over [From.GetHerHis] failure to claim Ironforge during the civil war. In fact, [From.GetSheHe] is currently assembling the forces of [From.GetHerHis] clan to assault you!
	picture = GFX_evt_dwarves
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		name = AKDAMN
	}
}

narrative_event = {
	id = threehammers.12
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.12 # [From.GetTitledName] is still holding a grudge over [From.GetHerHis] failure to claim Ironforge during the civil war. In fact, [From.GetSheHe] is currently assembling the forces of [From.GetHerHis] clan to assault it! You are in an unique position, however, to restore relations with Ironforge by lending them your aid... or to press your own claim on the ancient fortress-city once more.
	picture = GFX_evt_dwarves
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 0.5
			}
		}
		name = EVTOPT3HAMMER.12a # We shall come to their aid.
		k_ironforge = { 
			holder_scope = {
				join_defender_wars = ROOT
				letter_event = { id = threehammers.14 }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 50
			}
		}
		name = EVTOPT3HAMMER.12b # Ironforge is ours!
		k_ironforge = {
			holder_scope = {
				reverse_war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
				narrative_event = { id = threehammers.15 }
			}
		}
		if = {
			limit = {
				character = event_target:3h_darkiron
			}
			event_target:3h_wildhammer = {
				reverse_war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
				narrative_event = { id = threehammers.15 }
			}
		}
		if = {
			limit = {
				character = event_target:3h_wildhammer
			}
			event_target:3h_darkiron = {
				reverse_war = {
					target = ROOT
					casus_belli = 3hammer_war
				}
				narrative_event = { id = threehammers.15 }
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 50
			}
		}
		name = EVTOPT3HAMMER.12c # Let them fight their war. I no longer care.
	}
}

narrative_event = {
	id = threehammers.13
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.13 # The dwarven civil war over Khaz Modan has started once more. The great clans ready their forces and prepare to march against each other in their bid for total supremacy over the moutainous region.
	picture = GFX_evt_dwarves
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

letter_event = {
	id = threehammers.14
	desc = EVTTITLE3HAMMER.14 # To the [GetFromRootCompliment] [Root.GetTitledName]/n/nThough we previously fought in the first part of this terrible civil war, I no longer care for claiming the mountain halls you hold. As a gesture of reconciliation, I shall join you in defending against the enemy./n/nSigned,/n[From.GetTitledName]
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = AKGREAT
	}
}

narrative_event = {
	id = threehammers.15
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.15 # [From.GetTitledName] is still holding a grudge over [From.GetHerHis] failure to claim Ironforge during the civil war. In fact, [From.GetSheHe] is currently assembling the forces of [From.GetHerHis] clan to rejoin this civil war!
	picture = GFX_evt_dwarves
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		name = AKDAMN
	}
}

#Fall of Grim Batol
character_event = {
	id = threehammers.16
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		NOT = { has_global_flag = 3h_grim_batol }
		any_war = { using_cb = 3hammer_war }
		location = {
			province = 279
		}
		OR = {
			character = event_target:3h_darkiron
			any_liege = {
				character = event_target:3h_darkiron
			}
		}
		event_target:3h_darkiron = {
			OR = {
				has_artifact = xalalath
				any_realm_character = {
					has_artifact = xalalath
				}
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				event_target:3h_darkiron = {
					has_artifact = xalalath
				}
			}
			event_target:3h_darkiron = {
				narrative_event = { id = threehammers.17 }
				break = yes
			}
		}
		if = {
			limit = {
				event_target:3h_darkiron = {
					any_realm_character = {
						has_artifact = xalalath
					}
				}
			}
			event_target:3h_darkiron = {
				random_realm_character = {
					limit = {
						has_artifact = xalalath
					}
					narrative_event = { id = threehammers.17 }
				}
			}
		}
	}
}

narrative_event = {
	id = threehammers.17
	title = EVTTITLE3HAMMER.17 # Grim Batol
	desc = EVTDESC3HAMMER.17 # The fortress-city of Grim Batol is a formidable foritication and will take a long time to siege. However, Xal'alath tells you of another way. It is willing to help you cast a terrible curse that will surely break the defenders.
	picture = GFX_evt_grim_batol
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	immediate = {
		set_global_flag = 3h_grim_batol
	}
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 0.5
			}
		}
		name = EVTOPT3HAMMER.17a # Yes! Let us turn their fortress into a nightmare!
		c_grim_batol = {
			location = {
				add_province_modifier = { name = grim_batol_curse duration = -1 }
			}
		}
		random = {
			chance = 10
			add_trait = lunatic
		}
		any_playable_ruler = {
			limit = {
				ai = no
				NOT = { character = ROOT }
				OR = {
					trait = race_dwarf
					trait = race_gnome
				}
			}
			narrative_event = { id = threehammers.18 }
		}
		set_global_flag = 3h_grim_batol_cursed
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 50
			}
		}
		name = EVTOPT3HAMMER.17b # No, and stop whispering to me!
		piety = 50
		random = {
			chance = 10
			add_trait = lunatic
		}
	}
}

narrative_event = {
	id = threehammers.18
	title = EVTTITLE3HAMMER.17 # Grim Batol
	desc = EVTDESC3HAMMER.18 # The dwarven fortress-city of Grim Batol has been the victim of a terrible curse cast by [From.GetBestName]. Within Grim Batol shadows came to life to slaughter their owners and nightmares became real. Its once proud halls are now a place of terror and madness.
	picture = GFX_evt_grim_batol
	border = GFX_event_narrative_frame_war

	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Wildhammer migration
narrative_event = {
	id = threehammers.19
	title = EVTTITLE3HAMMER.17 # Grim Batol
	desc = EVTDESC3HAMMER.19 # Though the war is over, Grim Batol continues to be a cursed place of nightmares. Perhaps it would be best if your people were to abandon it and seek a new home elsewhere?
	picture = GFX_evt_grim_batol
	border = GFX_event_narrative_frame_war
	
	mean_time_to_happen = {
		months = 5
	}
	
	trigger = {
		war = no
		culture = wildhammer
		NOR = {
			trait = race_undead_generic
			trait = race_undead_scourge
			trait = race_undead_forsaken
		}
		has_global_flag = 3h_grim_batol_cursed
		higher_tier_than = DUKE
		OR = {
			has_landed_title = c_grim_batol
			any_vassal = {
				has_landed_title = c_grim_batol
			}
		}
		has_global_flag = 3hammer_start
		NOT = { has_global_flag = 3h_wildhammer_migrate }
		NOT = { has_global_flag = 3h_wildhammer_stay }
	}
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 0.5
			}
		}
		name = EVTOPT3HAMMER.19a # There is nothing left for us here. Let's seek another home to the north.
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 50
			}
		}
		name = EVTOPT3HAMMER.19b # This is our home, and we are not abandoning it!
		set_global_flag = 3h_wildhammer_stay
	}
}

#RAGNAROS!
narrative_event = {
	id = threehammers.20
	title = EVTTITLE3HAMMER.7 # The War of the Three Hammers
	desc = EVTDESC3HAMMER.20 # The war has not been going well for you. The rival clans even now make way into the heartlands of the Dark Irons. All seems lost, but perhaps there is a way. You know of a powerful, secret, ritual. One that could call up elemental legions and bind them to your will. But it will be risky.
	picture = GFX_evt_firelands
	border = GFX_event_narrative_frame_war
	
	min_age = 16
	prisoner = no
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		NOT = { has_global_flag = 3h_ragnaros }
		OR = {
			AND = {
				is_primary_war_defender = yes
				any_war = {
					using_cb = 3hammer_war
					war_score = 70
				}
			}
			AND = {
				is_primary_war_attacker = yes
				any_war = {
					using_cb = 3hammer_war
					war_score = -100
					NOT = { war_score = -69 }
				}
			}
		}
		character = event_target:3h_darkiron
	}
	
	option = {
		ai_chance = {
			factor = 100
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 0.5
			}
		}
		name = EVTOPT3HAMMER.20a # Begin the ritual.
		hidden_tooltip = {
			random_list = {
				5 = {
					narrative_event = { id = threhammers.21 }
				}
				1 = {
					modifier = {
						has_game_rule = {
							name = three_hammers_events
							value = alternate
						}
						factor = 5
					}
					narrative_event = { id = threhammers.22 }
				}
			}
		}
	}
	
	option = {
		ai_chance = {
			factor = 1
			modifier = {
				has_game_rule = {
					name = three_hammers_events
					value = alternate
				}
				factor = 50
			}
		}
		name = EVTOPT3HAMMER.20b # We win this with dwarven strength or not at all.
	}
}

narrative_event = {
	id = threehammers.21
	title = EVTTITLE3HAMMER.21 # Ragnaros!
	desc = EVTDESC3HAMMER.21 # You commence the ritual. You call upon the power of the fire, deep below the earth. But, through the ritual your thoughts turn to the bitter defeats you have suffered, to the rage you felt as you were thwarted time and again. The rage feeds into the ritual and now it is beyond your control. It reaches deeper, farther. Into the Firelands. Blackrock Mountain explodes, and fire engulfs you.
	picture = GFX_evt_ragnaros
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPT3HAMMER.21 # Tremble, insects!
		e_firelands = {
			holder_scope = {
				ROOT = {
					set_defacto_liege = PREV
				}
				c_blackrock_mountain = {
					grant_title = PREV
				}
			}
		}
		any_war = {
			limit = { using_cb = 3hammer_war }
			end_war = invalid
		}
		death = { death_reason = death_ragnaros }
		any_province = { # Can't use any lighter scopes, sadly.
			limit = {
				OR = {
					region = world_searing_gorge
					region = world_burning_steppes
				}
			}
			remove_province_modifier = redridge_blackrock
		}
		any_playable_ruler = {
			limit = {
				any_army = {
					location = {
						region = world_searing_gorge
						region = world_burning_steppes
					}
				}
			}
			any_army = {
				limit = {
					location = {
						region = world_searing_gorge
						region = world_burning_steppes
					}
				}
				troops = -10
			}
		}
		any_playable_ruler = {
			limit = {
				location = {
					region = world_EK_All
				}
			}
			narrative_event = { id = threehammers.23 }
		}
	}
}

narrative_event = {
	id = threehammers.22
	title = EVTTITLE3HAMMER.22 # Warriors of the Firelands
	desc = EVTDESC3HAMMER.22 # You commence the ritual. You call upon the power of the fire, deep below the earth. You call forth an army of molten warriors to do your bidding and turn the tide of this war.
	picture = GFX_evt_firelands
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = AKGREAT
		create_character = {
			age = 20000
			name = Geddon
			culture = fire_elemental
			religion = pyromancy
			dynasty = none
			random_traits = yes
			trait = race_fire_elemental
			flag = race_assigned
		}
		new_character = {
			TOW_initialize_character = yes
			spawn_unit = {
				province = 248
				home = 248
				owner = ROOT
				leader = THIS
				troops = {
					light_infantry = { 1000 1000 }
					heavy_infantry = { 400 400 }
					monsters = { 50 50 }
				}
				attrition = 0.5
				disband_on_peace = yes
				maintenance_multiplier = 0.5
				can_toggle_looting = no
			}
		}
	}
}

narrative_event = {
	id = threehammers.23
	title = EVTTITLE3HAMMER.21 # Ragnaros!
	desc = EVTDESC3HAMMER.23 # In [From.GetHerHis] attempt at conducting a ritual that would turn the tide of the war [From.GetSheHe] was in, [From.GetTitledName] accidentally summoned the Elemental Lord of Fire, Ragnaros, and died in the prcoess. The northern regions of the Redridge Mountains exploded with his fiery entry into the world, and Ragnaros has subjugated the Dark Iron dwarf clan and now rules from the depths of the now-volcanic Blackrock Mountain. 
	picture = GFX_evt_ragnaros
	border = GFX_event_narrative_frame_war
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Infinite interference
character_event = {
	id = threehammers.24
	desc = EVTDESC3HAMMER.24 # Strange grey dragons have started appearing out of nowhere and have joined your forces in battle. Though you don't know why they do this, this is clearly in your benefit.
	picture = "GFX_evt_infinite_dragon"
	border = "GFX_event_normal_frame_war"
	
	mean_time_to_happen = {
		years = 1000 # Need to test for how unlikely it is.
		modifier = {
			factor = 0.5
			has_game_rule = {
				name = three_hammers_events
				value = alternate
			}
		}
		modifier =	{
			factor = 0.1
			has_game_rule = {
				name = infinite_dragons
				value = more
			}
		}
	}
	
	trigger = {
		character = event_target:3h_darkiron
		NOT = { has_global_flag = 3h_infinites }
		any_war = {
			using_cb = 3hammer_war
			war_score = -100
			NOT = { war_score = -49 }
		}
		NOT = {
			has_game_rule = {
				name = infinite_dragons
				value = off
			}
		}
	}
	
	immediate = {
		set_global_flag = 3h_infinites
		create_character = {
			age = 440
			religion = cult_of_the_infinite
			culture = infinite_dragonflight
			dynasty = 101010
			attributes = {
				martial = 21
			}
			random_traits = yes
			trait = race_dragon_infinite
			trait = dragon_dragon
			flag = race_assigned
		}
		new_character = {
			TOW_initialize_character = yes
			save_event_target_as = 3h_infinite_leader
			create_title = {
				tier = DUKE
				temporary = yes
				culture = infinite_dragonflight
				name = INFINITE_INTERVENTION
				holder = THIS
			}
			ROOT = {
				location = {
					save_event_target_as = infinite_spawn
				}
				spawn_unit = {
					province = event_target:infinite_spawn
					owner = PREV
					leader = PREV
					disband_on_peace = yes
					troops = {
						dragon_troop = { 20 20 }
						heavy_infantry = { 900 900 }
						light_cavalry = { 550 550 }
					}
					attrition = 0
					maintenance = no
					reinforces = yes
				}
			}
			add_alliance = { 
				who = ROOT	
				years = 100 
			}
		}
	}
	
	option = {
		name = EVTOPTTROLLWAR.45 # Unexpected. But not unwelcome.
		hidden_tooltip = {
			any_playable_ruler = {
				limit = {
					ai = no
					war_with = ROOT
				}
				character_event = { id = threehammers.24 }
			}
		}
	}
}

character_event = {
	id = threehammers.26
	hide_window = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		NOT = {
			any_war = {
				using_cb = 3hammer_war
			}
		}
		character = event_target:3h_infinite_leader
	}
	
	immediate = {
		event_target:3h_infinite_leader = {
			death = { death_reason = death_missing }
		}
	}
}