namespace = dalaran

#Kirin Tor rises
character_event = {
	id = dalaran.1
	hide_window = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		has_global_flag = trollwars_bookmark
		NOR = {
			has_global_flag = dalaran_start
		}
		has_landed_title = c_dalaran
		has_landed_title = d_dalaran
		OR = {
			trait = arcanist
			trait = mage
		}
		religion = arcane
		NOT = {
			has_game_rule = {
				name = troll_wars_events
				value = off
			}
		}
	}
	
	immediate = {
		set_government_type = kirin_tor_government
		any_realm_character = {
			limit = {
				is_landed = yes
				OR = {
					trait = arcanist
					trait = mage
				}
				religion = arcane
				trait = race_human
			}
			set_government_type = kirin_tor_government
		}
		any_playable_ruler = {
			limit = {
				ai = no
				trait = race_human
			}
			narrative_event = { id = dalaran.2 }
		}
	}
}

narrative_event = {
	id = dalaran.2
	title = EVTTITLEDALARAN.2 # City of Magic
	desc = EVTDESCDALARAN.2 # Lately, the city of Dalaran has been attracting more and more magicians, lured in by the hopes of a society where they are free to exert their powers freely amongst their peers, without being subject to suspicion from those unaccustomed to the arcane. This great concentration of spellcasters has resulted in the city's government being replaced by a magocracy, the Council of Six.
	picture = GFX_evt_council_of_six
	border = GFX_event_narrative_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Council of Six
character_event = {
	id = dalaran.3
	desc = EVTDESCDALARAN.3 # It is brought to your attention that there are still vacant seats in the Council of Six. Dalaran cannot be administered properly without them!
	picture = GFX_evt_council_of_six
	border = GFX_event_normal_frame_diplomacy
	
	mean_time_to_happen = {
		months = 6
	}
	
	trigger = {
		NOT = {
			calc_true_if = {
				amount = 5
				any_realm_character = {
					has_minor_title = title_dalaran_six
				}
			}
		}
		OR = {
			has_landed_title = k_dalaran
			OR = {
				has_landed_title = d_dalaran
				NOT = { has_landed_title = k_dalaran }
				NOT = {
					any_playable_ruler = {
						has_landed_title = k_dalaran
						NOT = { character = ROOT }
					}
				}
			}
			OR = {
				has_landed_title = c_dalaran
				NOT = { has_landed_title = d_dalaran }
				NOT = { has_landed_title = k_dalaran }
				NOT = {
					any_playable_ruler = {
						has_landed_title = k_dalaran
						NOT = { character = ROOT }
					}
				}
				NOT = {
					any_playable_ruler = {
						has_landed_title = d_dalaran
						NOT = { character = ROOT }
					}
				}
			}
		}
		government = kirin_tor_government
	}
	
	option = {
		name = EVTOPTDALARAN.3a # Very well, give me some time.
		character_event = { id = dalaran.4 days = 60 }
	}
	
	option = {
		name = EVTOPTDALARAN.3b # I don't care who fills these positions, just handle it!
		hidden_tooltip = {
			while = {
				limit = {
					NOT = {
						any_realm_character = {
							count = 5
							has_minor_title = title_dalaran_six
						}
					}
				}
				if = {
					limit = {
						any_realm_character = {
							NOT = { has_minor_title = title_dalaran_six }
							learning = 15
							OR = {
								trait = mage
								trait = arcanist
							}
							NOR = {
								religion = cult_of_the_infinite
								religion = cult_of_the_destroyer
								religion = emerald_nightmare
								religion = old_gods
								religion = twilights_hammer
								religion = azshara
								religion = burning_legion
								religion = demonology
								religion = lich_king
							}
						}
					}
					random_realm_character = {
						limit = {
							NOT = { has_minor_title = title_dalaran_six }
							learning = 15
							OR = {
								trait = mage
								trait = arcanist
							}
						}
						give_minor_title = title_dalaran_six
					}
				}
				if = {
					limit = {
						NOT = {
							any_realm_character = {
								NOT = { has_minor_title = title_dalaran_six }
								learning = 15
								OR = {
									trait = mage
									trait = arcanist
								}
							}
						}
					}
					random_list = {
						20 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						20 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						10 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						10 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = no
								religion = sunwell
								culture = high_elven
								trait = mage
								trait = race_high_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = yes
								religion = sunwell
								culture = high_elven
								trait = mage
								trait = race_high_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = sindorei }
							}
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = no
								religion = sunwell
								culture = blood_elven
								trait = mage
								trait = race_blood_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = sindorei }
							}
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = yes
								religion = sunwell
								culture = blood_elven
								trait = mage
								trait = race_blood_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_global_flag = gnome_awakening }
									has_global_flag = trollwars_bookmark
								}
							}
							create_character = {
								age = 50
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 16
								}
								female = no
								religion = arcane
								culture = gnomish
								trait = mage
								trait = race_gnome
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_global_flag = gnome_awakening }
									has_global_flag = trollwars_bookmark
								}
							}
							create_character = {
								age = 50
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 16
								}
								female = yes
								religion = arcane
								culture = gnomish
								trait = mage
								trait = race_gnome
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = demonology
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = demonology
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = burning_legion
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = burning_legion
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = secondwar_bookmark }
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = forgotten_shadow
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = secondwar_bookmark }
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = forgotten_shadow
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = lich_king
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = lich_king
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = old_gods
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = old_gods
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = twilights_hammer
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								TOW_initialize_adult_character = yes
								set_secret_religion = twilights_hammer
								give_minor_title = title_dalaran_six
							}
						}
					}
				}
			}
		}
	}
}

#Still vacant slots after promising.
character_event = {
	id = dalaran.4
	desc = EVTOPTDALARAN.4 # Due to taking too long to fulfil your promise to fill the Council of Six's vacant seats, the mages of Dalaran have organized and voted on representatives to take those seats.
	picture = GFX_evt_council_of_six
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = OK
		prestige = -10
		hidden_tooltip = {
			while = {
				limit = {
					NOT = {
						any_realm_character = {
							count = 5
							has_minor_title = title_dalaran_six
						}
					}
				}
				if = {
					limit = {
						any_realm_character = {
							NOT = { has_minor_title = title_dalaran_six }
							learning = 15
							OR = {
								trait = mage
								trait = arcanist
							}
							NOR = {
								religion = cult_of_the_infinite
								religion = cult_of_the_destroyer
								religion = emerald_nightmare
								religion = old_gods
								religion = twilights_hammer
								religion = azshara
								religion = burning_legion
								religion = demonology
								religion = lich_king
							}
						}
					}
					random_realm_character = {
						limit = {
							NOT = { has_minor_title = title_dalaran_six }
							learning = 15
							OR = {
								trait = mage
								trait = arcanist
							}
							NOR = {
								religion = cult_of_the_infinite
								religion = cult_of_the_destroyer
								religion = emerald_nightmare
								religion = old_gods
								religion = twilights_hammer
								religion = azshara
								religion = burning_legion
								religion = demonology
								religion = lich_king
							}
						}
						give_minor_title = title_dalaran_six
					}
				}
				if = {
					limit = {
						NOT = {
							any_realm_character = {
								NOT = { has_minor_title = title_dalaran_six }
								learning = 15
								OR = {
									trait = mage
									trait = arcanist
								}
								NOR = {
									religion = cult_of_the_infinite
									religion = cult_of_the_destroyer
									religion = emerald_nightmare
									religion = old_gods
									religion = twilights_hammer
									religion = azshara
									religion = burning_legion
									religion = demonology
									religion = lich_king
								}
							}
						}
					}
					random_list = {
						20 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						20 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						10 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						10 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = no
								religion = sunwell
								culture = high_elven
								trait = mage
								trait = race_high_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = yes
								religion = sunwell
								culture = high_elven
								trait = mage
								trait = race_high_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = sindorei }
							}
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = no
								religion = sunwell
								culture = blood_elven
								trait = mage
								trait = race_blood_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						5 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = sindorei }
							}
							create_character = {
								age = 400
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 18
								}
								female = yes
								religion = sunwell
								culture = blood_elven
								trait = mage
								trait = race_blood_elf
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_global_flag = gnome_awakening }
									has_global_flag = trollwars_bookmark
								}
							}
							create_character = {
								age = 50
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 16
								}
								female = no
								religion = arcane
								culture = gnomish
								trait = mage
								trait = race_gnome
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_global_flag = gnome_awakening }
									has_global_flag = trollwars_bookmark
								}
							}
							create_character = {
								age = 50
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 16
								}
								female = yes
								religion = arcane
								culture = gnomish
								trait = mage
								trait = race_gnome
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = demonology
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = demonology
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = burning_legion
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = warlock
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = burning_legion
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = secondwar_bookmark }
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = forgotten_shadow
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = secondwar_bookmark }
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = forgotten_shadow
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = lich_king
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = necromancer
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = lich_king
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = old_gods
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = old_gods
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = no
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = twilights_hammer
								give_minor_title = title_dalaran_six
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { has_global_flag = thirdwar_bookmark }
								NOT = { has_global_flag = wow_bookmark }
							}
							create_character = {
								age = 45
								random_traits = yes
								dynasty = random
								attributes = {
									learning = 15
								}
								female = yes
								religion = arcane
								culture = dalaranian
								trait = mage
								trait = race_human
								flag = race_assigned
								flag = has_adv_class
							}
							new_character = {
								set_secret_religion = twilights_hammer
								give_minor_title = title_dalaran_six
							}
						}
					}
				}
			}
		}
	}
}

#Six asks for land
character_event = {
	id = dalaran.5
	hide_window = yes
	
	capable_only = yes
	prisoner = no
	min_age = 16
	
	trigger = {
		has_minor_title = title_dalaran_six
		is_ruler = no
		liege = {
			OR = {
				has_landed_title = c_dalaran
				has_landed_title = d_dalaran
				has_landed_title = k_dalaran
			}
			OR = {
				tier = DUKE
				tier = KING
				tier = EMPEROR
			}
			has_regent = no
			war = no
			NOT = { has_opinion_modifier = { who = ROOT modifier = requested_land } }
			NOT = {
				character = ROOT
			}
			demesne_size = 3
			any_demesne_title = {
				can_be_given_away = yes
				tier = COUNT
				NOT = { location = { is_capital = yes } }
			}
		}
	}
	
	mean_time_to_happen = {
		months = 480
		modifier = {
			factor = 0.5
			trait = greedy
		}
		modifier = {
			factor = 0.5
			trait = envious
		}
		modifier = {
			factor = 2.0
			trait = kind
		}
		modifier = {
			factor = 2.0
			trait = charitable
		}
		modifier = {
			factor = 2.0
			trait = content
		}
	}
	
	immediate = {
		liege = {
			random_demesne_title = {
				limit = {
					can_be_given_away = yes
					tier = COUNT
					NOT = { location = { is_capital = yes } }
				}
				save_event_target_as = vassal_wanted_title
			}
			opinion = {
				who = ROOT
				years = 2
				modifier = requested_land
			}
			letter_event = { id = dalaran.6 tooltip = EVTTOOLTIP63041 }
		}
	}
}

# Liege receives the request
letter_event = {
	id = dalaran.6
	desc = EVTDESCDALARAN.6 # [Root.GetTitledFirstName], I feel like I should aid in carrying the burden that is administering our realm, and, as such, I ask that I be granted a title that I may be able to do so.\n\nA fellow member of the Council, [From.GetTitledFirstName]
	
	is_friendly = yes
	
	border = GFX_event_letter_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		trigger = {
			has_dlc = "Zeus"
			NOT = { holds_favor_on = FROM }
		}
		name = EVTOPTD63041 # Accept the request
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				trait = greedy
			}
		}

		add_favor = FROM

		event_target:vassal_wanted_title = {
			gain_title = FROM
		}
	}

	option = {
		name = EVTOPTA63041 # Accept the request
		ai_chance = {
			factor = 50
			modifier = {
				factor = 0
				trait = greedy
			}
			modifier = {
				factor = 0
				NOT = {
					opinion = { who = FROM value = -20 }
				}
			}
			modifier = {
				factor = 0.5
				NOT = {
					opinion = { who = FROM value = 25 }
				}
			}
			modifier = {
				factor = 0.5
				NOT = {
					opinion = { who = FROM value = 50 }
				}
			}
			modifier = {
				factor = 3
				is_friend = FROM
			}
		}
		event_target:vassal_wanted_title = {
			gain_title = FROM
		}
		reverse_opinion = {
			modifier = opinion_grateful
			who = FROM
			months = 120
		}
	}
	
	option = {
		name = EVTOPTB63041 # Deny the request
		ai_chance = { 
			factor = 100
			modifier = {
				factor = 0.5
				trait = charitable
			}
			modifier = {
				factor = 0.75
				opinion = { who = FROM value = 20 }
			}
			modifier = {
				factor = 0.5
				opinion = { who = FROM value = 50 }
			}
		}
		FROM = { 
			opinion = {
				modifier = opinion_disappointed
				who = ROOT
				months = 120
			}
			prestige = -100
		}
	}
	
	option = {
		name = EVTOPTC63041 # Deny with superior diplomacy
		tooltip_info = diplomacy
		trigger = {
			diplomacy = 9
		}
		ai_chance = {
			factor = 1000
		}
	}
}

#Succession.
character_event = {
	id = dalaran.7
	hide_window = yes
	
	is_triggered_only = yes
	
	trigger = {
		OR = {
			AND = {
				is_title_active = k_dalaran
				has_landed_title = k_dalaran
			}
			AND = {
				NOT = { is_title_active = k_dalaran }
				is_title_active = d_dalaran
				has_landed_title = d_dalaran
			}
			AND = {
				NOT = { is_title_active = k_dalaran }
				NOT = { is_title_active = d_dalaran }
				has_landed_title = c_dalaran
			}
		}
		government = kirin_tor_government
	}
	
	immediate = {
		random_realm_character = {
			limit = {
				has_minor_title = title_dalaran_six
			}
			save_event_target_as = dal_succ
		}
		while = {
			limit = {
				NOT = {
					calc_true_if = {
						amount = 5
						any_realm_character = {
							has_character_flag = dal_succ_passed
						}
					}
				}
			}
			random_realm_character = {
				limit = {
					has_minor_title = title_dalaran_six
					NOT = { has_character_flag = dal_succ_passed }
				}
				if = {
					limit = {
						attribute_diff = {
							character = event_target:dal_succ
							attribute = learning
							value = 1
						}
					}
					event_target:dal_succ = {
						clear_event_target = dal_succ
						set_character_flag = dal_succ_passed
					}
					save_event_target_as = dal_succ
				}
				if = {
					limit = {
						NOT = {
							attribute_diff = {
								character = event_target:dal_succ
								attribute = learning
								value = 1
							}
						}
					}
					set_character_flag = dal_succ_passed
				}
			}
		}
		event_target:dal_succ = {
			inherit = ROOT
			clear_event_target = dal_succ
		}
		any_realm_character = {
			limit = {
				has_character_flag = dal_succ_passed
			}
			clr_character_flag = dal_succ_passed
		}
	}
}

#Unhappy mage goes to Dalaran
character_event = {
	id = dalaran.8
	hide_window = yes
	
	mean_time_to_happen = {
		years = 5
		modifier = {
			factor = 10
			has_job_title = yes
		}
		modifier = {
			factor = 2
			any_playable_ruler = {
				dynasty =  ROOT
			}
		}
		modifier = {
			factor = 0.5
			true_religion = arcane
		}
		modifier = {
			factor = 5
			NOT = { trait = race_human }
		}
		modifier = {
			factor = 3
			NOT = {
				location = {
					region = world_EK_North
				}
			}
		}
		modifier = {
			factor = 2
			liege = {
				reverse_opinion = { who = ROOT value = -25 }
			}
		}
		modifier = {
			factor = 0.2
			liege = {
				trait = distrusts_magic
			}
		}
	}
	
	trigger = {
		NOT = {
			any_liege = {
				government = kirin_tor_government
			}
		}
		liege = {
			NOT = { reverse_opinion = { who = ROOT value = 0 } }
		}
		OR = {
			k_dalaran = {
				holder_scope = {
					government = kirin_tor_government
				}
			}
			d_dalaran = {
				holder_scope = {
					government = kirin_tor_government
				}
			}
			c_dalaran = {
				holder_scope = {
					government = kirin_tor_government
				}
			}
		}
		is_ruler = no
		OR = {
			trait = arcanist
			trait = mage
			trait = techmage
		}
		is_heir = no
		OR = {
			trait = race_human
			trait = race_dwarf
			trait = race_gnome
			trait = race_high_elf
			trait = race_blood_elf # add condition to see if they're not horde, or if Dalaran's neutral
		}
	}
	
	immediate = {
		liege = {
			character_event = { id = dalaran.9 }
		}
		if = {
			limit = {
				is_title_active = k_dalaran
				k_dalaran = {
					holder_scope = {
						government = kirin_tor_government
					}
				}
			}
			k_dalaran = {
				holder_scope = {
					ROOT = {
						move_character = PREV
					}
					character_event = { id = dalaran.10 }
				}
			}
		}
		if = {
			limit = {
				NOT = { is_title_active = k_dalaran }
				is_title_active = d_dalaran
				d_dalaran = {
					holder_scope = {
						government = kirin_tor_government
					}
				}
			}
			d_dalaran = {
				holder_scope = {
					ROOT = {
						move_character = PREV
					}
					character_event = { id = dalaran.10 }
				}
			}
		}
		if = {
			limit = {
				NOT = { is_title_active = d_dalaran }
				is_title_active = c_dalaran
				c_dalaran = {
					holder_scope = {
						government = kirin_tor_government
					}
				}
			}
			c_dalaran = {
				holder_scope = {
					ROOT = {
						move_character = PREV
					}
					character_event = { id = dalaran.10 }
				}
			}
		}
	}
}

#Ruler notified
character_event = {
	id = dalaran.9
	desc = EVTDESCDALARAN.9 # [From.GetBestName] has left your court to go to Dalaran.
	notification = yes
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Dalaran notified
character_event = {
	id = dalaran.10
	desc = EVTDESCDALARAN.10 # [From.GetBestName], disgruntled with [From.GetHerHis] former liege, has arrived at your court.
	notification = yes
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Dalaran ruler informed kid sent to be educated.
character_event = {
	id = dalaran.11
	desc = EVTDESCDALARAN.11 # [From.GetBestName] has sent by [From.GetHerHis] family to be educated in the arcane at your city.
	notification = yes
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

#Kid sent to Dalaran returns.
character_event = {
	id = dalaran.12
	hide_window = yes
	
	is_triggered_only = yes
	
	immediate = {
		event_target:sktd_liege = {
			character_event = { id = dalaran.13 }
			ROOT = {
				move_character = PREV
			}
		}
		random = {
			chance = 5
			add_trait = depressed
		}
		random = {
			chance = 1
			set_secret_religion = burning_legion
		}
		random = {
			chance = 1
			set_secret_religion = old_gods
		}
		random = {
			chance = 20
			add_trait = stressed
		}
		random = {
			chance = 20
			add_trait = drunkard
		}
		random = {
			chance = 10
			random_list = {
				2 = {
					modifier = {
						factor = 0
						trait = celibate
					}
					add_trait = hedonist
				}
				1 = {
					add_trait = duelist
				}
				2 = {
					add_trait = socializer
				}
				1 = {
					if = {
						limit = {
							NOT = { trait = celibate }
							is_female = no
						}
						add_trait = seducer
					}
					if = {
						limit = {
							NOT = { trait = celibate }
							is_female = yes
						}
						add_trait = seductress
					}
				}
				2 = {
					add_trait = gamer
				}
				2 = {
					add_trait = poet
				}
			}
		}
		random = {
			chance = 20
			remove_trait = diligent
			add_trait = slothful
		}
		random = {
			chance = 20
			remove_trait = chaste
			add_trait = lustful
		}
		random = {
			chance = 10
			add_trait = gregarious
		}
		random = {
			chance = 10
			remove_trait = zealous
			add_trait = cynical
		}
		prestige = -100
		clear_event_target = event_target:sktd_liege
	}
}

#Liege is told.
character_event = {
	id = dalaran.13
	desc = EVTDESCDALARAN.13 # [From.GetFirstName] has returned from Dalaran, apparently having dropped out for some reason or another.
	picture = GFX_evt_drunk
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTDALARAN.13 # This is a shameful display.
		opinion = {
			who = FROM
			modifier = opinion_disappointed
			years = 5
		}
	}
}

#Kirin tor owner gives away (not conquered) c_dalaran or d_dalaran
character_event = {
	id = dalaran.14
	hide_window = yes
	
	mean_time_to_happen = {
		days = 1
	}
	
	trigger = {
		OR = {
			has_landed_title = k_dalaran
			has_landed_title = d_dalaran
		}
		government = kirin_tor_government
		OR = {
			NOT = { has_landed_title = c_dalaran }
			NOT = { has_landed_title = d_dalaran }
		}
		any_realm_character = {
			OR = {
				has_landed_title = c_dalaran
				has_landed_title = d_dalaran
			}
		}
	}
	
	immediate = {
		if = {
			limit = {
				is_title_active = d_dalaran
				NOT = { has_landed_title = d_dalaran }
			}
			d_dalaran = { grant_title = ROOT }
		}
		if = {
			limit = {
				NOT = { has_landed_title = c_dalaran }
			}
			c_dalaran = { grant_title = ROOT }
		}
	}
}