namespace = hallows

#Hallow's End beings
character_event = {
	id = hallows.1
	desc = {
		trigger = {
			NOT = { culture = forsaken }
		}
		text = EVTDESCHALLOW.1a # Today marks the start of Hallow's End, the celebration at the end of the year's last harvest.
	}
	desc = {
		trigger = {
			culture = forsaken
		}
		text = EVTDESCHALLOW.1b # Today marks the start of Hallow's End, the celebration of your freedom from the grasp of the Scourge.
	}
	picture = GFX_evt_hallow1
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = OK
		set_character_flag = hallows_end_begin
	}
}

#Masked revellers
character_event = {
	id = hallows.2
	desc = EVTDESCHALLOW.2 # As part of Hallow's End, many celebrants put on masks and costumes and roam the streets, partying.
	picture = GFX_evt_jugglers

	min_age = 20
	capable_only = yes
	prisoner = no
	only_rulers = yes

	trigger = {
		has_character_modifier = holding_hallows_end
		
		OR = {
			NOT = { has_character_flag = hallows_event_happened }
			had_character_flag = {
				flag = hallows_event_happened
				days = 3
			}
		}

		had_character_flag = {
			flag = hallows_end_begin
			days = 3
		}
		NOT = { has_character_flag = hallows_masks }
	}
	
	immediate = {
		set_character_flag = hallows_event_happened
		set_character_flag = hallows_masks
	}
	
	mean_time_to_happen = {
		days = 180
		
		modifier = {
			factor = 0.33
			NOT = { has_character_flag = hallows_event_happened }
		}	
		
		modifier = {
			factor = 1.5
			has_character_flag = hallows_event_happened
		}			

		modifier = {
			factor = 0.5
			trait = shy
		}
		modifier = {
			factor = 2
			trait = gregarious
		}	
	}
	
	option = {
		name = EVTOPTHALLOW.2a # Put on a mask and join them!
		prestige = 5
		hidden_tooltip = {
			random = {
				chance = 20
				remove_trait = stressed
			}
			random = {
				chance = 5
				remove_trait = depressed
			}
		}
	}
	
	option = {
		name = EVTOPTHALLOW.2b # What a silly thing to do.
		prestige = -5
		hidden_tooltip = {
			random = {
				chance = 10
				add_trait = stressed
			}
		}
	}
}

#Harvest Fair
character_event = {
	id = hallows.3
	desc = EVTDESCHALLOW.3 # It is customary for merchants and farmers to sell their wares during the celebrations, and shops have been set all over town.
	picture = "GFX_evt_market"

	min_age = 20
	capable_only = yes
	prisoner = no
	only_rulers = yes

	trigger = {
		has_character_modifier = holding_hallows_end
		
		OR = {
			NOT = { has_character_flag = hallows_event_happened }
			had_character_flag = {
				flag = hallows_event_happened
				days = 3
			}
		}

		had_character_flag = {
			flag = hallows_end_begin
			days = 3
		}
		NOT = { has_character_flag = hallows_fair }
	}
	
	immediate = {
		set_character_flag = hallows_event_happened
		set_character_flag = hallows_fair
	}	

	mean_time_to_happen = {
		days = 180
		
		modifier = {
			factor = 0.33
			NOT = { has_character_flag = hallows_event_happened }
		}	
		
		modifier = {
			factor = 1.5
			has_character_flag = hallows_event_happened
		}

		modifier = {
			factor = 0.75
			trait = greedy
		}

		modifier = {
			factor = 2.5
			trait = charitable
		}
	}

	option = {
		name = EVTOPTHALLOW.3a # Let's see what they have for sale.
		wealth = -5
		if = {
			limit = {
				NOT = { has_dlc = "Reapers" }
			}
			prestige = 10
		}
		if = {
			limit = {
				has_dlc = "Reapers"
			}
			custom_tooltip = {
				text = capital_prospers_custom_tooltip
				hidden_tooltip = {
					capital_scope = {
						change_variable = { which = prosperity_value value = 8 }
					}
				}
			}
		}
	}
	
	option = {
		name = EVTOPTHALLOW.3b # I don't care.
		prestige = -5
	}

	option = {
		trigger = {
			OR = {
				trait = cruel
				trait = impaler
				trait = wroth
			}
		}
		name = EVTOPTHALLOW.3c # Stupid commoners, clogging the streets with stalls!
		capital_scope = {
			add_province_modifier = {
				name = peasants_upset
				duration = 365
			}
		}
	}
}

#Spoopy tales
character_event = {
	id = hallows.4
	desc = EVTDESCHALLOW.4 # It has become something of a tradition for spooky stories to be recounted in front of an audience, to both their amusement and horror.
	picture = "GFX_evt_headless_horseman"

	min_age = 20
	capable_only = yes
	prisoner = no
	only_rulers = yes

	trigger = {
		has_character_modifier = holding_hallows_end
		
		OR = {
			NOT = { has_character_flag = hallows_event_happened }
			had_character_flag = {
				flag = hallows_event_happened
				days = 3
			}
		}

		had_character_flag = {
			flag = hallows_end_begin
			days = 3
		}
		NOT = { has_character_flag = hallows_spoopy }
	}
	
	immediate = {
		set_character_flag = hallows_event_happened
		set_character_flag = hallows_spoopy
	}	

	mean_time_to_happen = {
		days = 180
		
		modifier = {
			factor = 0.33
			NOT = { has_character_flag = hallows_event_happened }
		}	
		
		modifier = {
			factor = 1.5
			has_character_flag = hallows_event_happened
		}

		modifier = {
			factor = 0.75
			trait = brave
		}

		modifier = {
			factor = 2.5
			trait = craven
		}
		
		modifier = {
			factor = 2.5
			trait = cynical
		}
	}

	option = {
		name = EVTOPTHALLOW.4a # A headless horseman? Tell me more!
		prestige = 5
		hidden_tooltip = {
			random_list = {
				100 = { }
				10 = {
					modifier = {
						factor = 0
						NOT = { trait = brave }
					}
					remove_trait = brave
				}
				10 = {
					modifier = {
						factor = 0
						trait = craven
					}
					remove_trait = brave
					add_trait = craven
				}
				10 = {
					modifier = {
						factor = 0
						trait = cynical
					}
					remove_trait = zealous
					add_trait = cynical
				}
			}
		}
	}
	
	option = {
		name = EVTOPTHALLOW.3b # I don't care.
		prestige = -5
	}
}

#The Wickerman
character_event = {
	id = hallows.5
	desc = EVTDESCHALLOW.5 # The time has come to burn the wickerman and bring Hallow's End to a close. You are expected to make a speech before burning the wickerman. What shall you speak of?
	picture = GFX_evt_hallow2
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		any_realm_character = {
			limit = {
				is_ruler = yes
				OR = {
					AND = {
						trait = race_human
						NOT = { culture = forsaken }
						ROOT = {
							trait = race_human
							NOT = { culture = forsaken }
						}
					}
					AND = {
						culture = forsaken
						ROOT = {
							culture = forsaken
						}
					}
				}
			}
			character_event = { id = hallows.6 }
		}
	}
	
	option = {
		trigger = {
			NOT = { culture = forsaken }
			NOT = { trait = shy }
			NOT = { trait = depressed }
		}
		name = EVTOPTHALLOW.5a # Speak of tradition and duty.
		set_character_flag = hallows_speech1
		character_event = { id = hallows.7 }
	}
	
	option = {
		trigger = {
			NOT = { culture = forsaken }
			NOT = { trait = shy }
			NOT = { trait = depressed }
		}
		name = EVTOPTHALLOW.5b # Speak of the harvest and winter.
		set_character_flag = hallows_speech2
		character_event = { id = hallows.7 }
	}
	
	option = {
		trigger = {
			culture = forsaken
			NOT = { trait = shy }
			NOT = { trait = depressed }
		}
		name = EVTOPTHALLOW.5c # Speak of determination and tenacity.
		set_character_flag = hallows_speech3
		character_event = { id = hallows.7 }
	}
	
	option = {
		trigger = {
			culture = forsaken
			NOT = { trait = shy }
			NOT = { trait = depressed }
		}
		name = EVTOPTHALLOW.5d # Speak of vengeance and wrath.
		set_character_flag = hallows_speech4
		character_event = { id = hallows.7 }
	}
	
	option = {
		trigger = {
			trait = shy
			NOT = { trait = depressed }
		}
		name = EVTOPTHALLOW.5e # Try to make up a speech.
		set_character_flag = hallows_speech5
		character_event = { id = hallows.7 }
	}
	
	option = {
		trigger = {
			trait = depressed
		}
		name = EVTOPTHALLOW.5f # Speak of futility and endings.
		set_character_flag = hallows_speech6
		character_event = { id = hallows.7 }
	}
}

character_event = {
	id = hallows.6
	desc = EVTDESCHALLOW.6 # The time has come to burn the wickerman and bring Hallow's End to a close. [From.GetTitledName] expected to make a speech before burning the wickerman. You await for [From.GetHerHim] to start.
	picture = GFX_evt_hallow2
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = OK
	}
}

character_event = {
	id = hallows.7
	desc = {
		trigger = {
			has_character_flag = hallows_speech1
		}
		text = EVTDESCHALLOW.7a # You speak of tradition, of duty. Of staying true to your roots and standing tall against those who would destroy all you cherish. To face the monsters of the world with courage and honour, as befits all humans.
	}
	desc = {
		trigger = {
			has_character_flag = hallows_speech2
		}
		text = EVTDESCHALLOW.7b # You speak of the harvest and the importance of the peasantry to the realm. You also speak of the coming winter and the time of reflections it brings. It is time to cast sorrow and regrets aside, lest you take them into it.
	}
	desc = {
		trigger = {
			has_character_flag = hallows_speech3
		}
		text = EVTDESCHALLOW.7c # You speak of how alone the forsaken are, of how it seems the entire world is out to get you. And that, despite this, you need to keep going. Through determination, through will, you will prevail.
	}
	desc = {
		trigger = {
			has_character_flag = hallows_speech4
		}
		text = EVTDESCHALLOW.7d # You speak of how hate of the world for your people. Of how they treat you like monsters. Of the Scourge that sought to enslave you. You remind your listeners that vengeance will be yours, and none shall stand in your way.
	}
	desc = {
		trigger = {
			has_character_flag = hallows_speech5
		}
		text = EVTDESCHALLOW.7e # You attempt to make a speech, only to stutter and stand in awkward silence, at a loss for words.
	}
	desc = {
		trigger = {
			has_character_flag = hallows_speech6
		}
		text = EVTDESCHALLOW.7f # You speak of how meaningless everything is, of how life sometimes seems like you are just rushing headlong into oblivion, and nothing you will ever do matters.
	}
	picture = GFX_evt_hallow2
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		any_realm_character = {
			limit = {
				is_ruler = yes
				OR = {
					AND = {
						trait = race_human
						NOT = { culture = forsaken }
						ROOT = {
							trait = race_human
							NOT = { culture = forsaken }
						}
					}
					AND = {
						culture = forsaken
						ROOT = {
							culture = forsaken
						}
					}
				}
			}
			character_event = { id = hallows.8 }
		}
	}
	
	option = {
		name = EVTOPTHALLOW.7 # Burn the wickerman.
		if = {
			limit = {
				has_character_flag = hallows_speech5
			}
			prestige = -50
		}
		character_event = { id = hallows.9 }
	}
}

character_event = {
	id = hallows.8
	desc = {
		trigger = {
			FROM = { has_character_flag = hallows_speech1 }
		}
		text = EVTDESCHALLOW.8a # [From.GetTitledName] speaks of tradition, of duty. Of staying true to your roots and standing tall against those who would destroy all you cherish. To face the monsters of the world with courage and honour, as befits all humans.
	}
	desc = {
		trigger = {
			FROM = { has_character_flag = hallows_speech2 }
		}
		text = EVTDESCHALLOW.8b # [From.GetTitledName] speaks of the harvest and the importance of the peasantry to the realm. [From.GetSheHe] also speaks of the coming winter and the time of reflections it brings. It is time to cast sorrow and regrets aside, lest you take them into it.
	}
	desc = {
		trigger = {
			FROM = { has_character_flag = hallows_speech3 }
		}
		text = EVTDESCHALLOW.8c # [From.GetTitledName] speaks of how alone the forsaken are, of how it seems the entire world is out to get you. And that, despite this, you need to keep going. Through determination, through will, you will prevail.
	}
	desc = {
		trigger = {
			FROM = { has_character_flag = hallows_speech4 }
		}
		text = EVTDESCHALLOW.8d # [From.GetTitledName] speak of how hate of the world for your people. Of how they treat you like monsters. Of the Scourge that sought to enslave you. [From.GetSheHe] reminds you that vengeance will be yours, and none shall stand in your way.
	}
	desc = {
		trigger = {
			FROM = { has_character_flag = hallows_speech5 }
		}
		text = EVTDESCHALLOW.8e # [From.GetTitledName] attempts to make a speech, only to stutter and stand in awkward silence, at a loss for words.
	}
	desc = {
		trigger = {
			FROM = { has_character_flag = hallows_speech6 }
		}
		text = EVTDESCHALLOW.8f # [From.GetTitledName] speaks of how meaningless everything is, of how life sometimes seems like you are just rushing headlong into oblivion, and nothing you will ever do matters.
	}
	picture = GFX_evt_hallow2
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	option = {
		name = EVTOPTHALLOW.8 # [From.GetTitledName] burns the wickerman.
		if = {
			limit = {
				FROM = { has_character_flag = hallows_speech5 }
			}
			opinion = { modifier = opinion_disappointed who = FROM months = 4 }
		}
		hidden_tooltip = {
			if = {
				limit = {
					FROM = { has_character_flag = hallows_speech6 }
				}
				random_list = {
					100 = { }
					5 = {
						add_trait = stressed
					}
					1 = {
						add_trait = depressed
					}
				}
			}
		}
	}
}

character_event = {
	id = hallows.9
	desc = EVTDESCHALLOW.9 # You take a torch and set the huge wickerman on fire. It represents all sorrows and regrets, to be burned away before the coming of winter. Hallow's End is over.
	picture = GFX_evt_hallow2
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		any_realm_character = {
			limit = {
				is_ruler = yes
				OR = {
					AND = {
						trait = race_human
						NOT = { culture = forsaken }
						ROOT = {
							trait = race_human
							NOT = { culture = forsaken }
						}
					}
					AND = {
						culture = forsaken
						ROOT = {
							culture = forsaken
						}
					}
				}
			}
			character_event = { id = hallows.10 }
		}
		clr_character_flag = hallows_speech1
		clr_character_flag = hallows_speech2
		clr_character_flag = hallows_speech3
		clr_character_flag = hallows_speech4
		clr_character_flag = hallows_speech5
		clr_character_flag = hallows_speech6
		remove_character_modifier = holding_hallows_end
		clr_character_flag = do_not_disturb
		clr_character_flag = hallows_event_happened
		clr_character_flag = hallows_end_begin
		set_character_flag = recent_hallows_end
		clr_character_flag = hallows_masks
		clr_character_flag = hallows_fair
		clr_character_flag = hallows_spoopy
	}
	
	option = {
		name = EVTOPTHALLOW.9 # Until next year.
		prestige = 10
	}
}

character_event = {
	id = hallows.10
	desc = EVTDESCHALLOW.10 # [From.GetTitledName] takes a torch and sets the huge wickerman on fire. It represents all sorrows and regrets, to be burned away before the coming of winter. Hallow's End is over.
	picture = GFX_evt_hallow2
	border = GFX_event_normal_frame_economy
	
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = hallows_speech1
		clr_character_flag = hallows_speech2
		clr_character_flag = hallows_speech3
		clr_character_flag = hallows_speech4
		clr_character_flag = hallows_speech5
		clr_character_flag = hallows_speech6
		remove_character_modifier = holding_hallows_end
		clr_character_flag = do_not_disturb
		clr_character_flag = hallows_event_happened
		clr_character_flag = hallows_end_begin
		set_character_flag = recent_hallows_end
		clr_character_flag = hallows_masks
		clr_character_flag = hallows_fair
		clr_character_flag = hallows_spoopy
	}
	
	option = {
		trigger = {
			culture = forsaken
		}
		name = EVTOPTHALLOW.10a # Paint your face with the ashes.
		add_character_modifier = { name = will_of_the_forsaken duration = 90 }
		prestige = 5
	}
	
	option = {
		name = EVTOPTHALLOW.9 # Until next year.
		prestige = 10
	}
}